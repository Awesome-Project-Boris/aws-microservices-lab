<div id="write" class="">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.3.0/css/all.css">
    <h1 id="building-microservices-and-a-cicd-pipeline-with-aws"><span>Building Microservices and a CI/CD Pipeline with
            AWS</span></h1>
    <h2 id="table-of-contents"><span>Table of contents</span></h2>
    <p><a href="#poao" target="_self" rel="noopener noreferrer"><span>Project overview and objectives</span></a>
        <a href="#le" target="_self" rel="noopener noreferrer"><span>The lab environment and monitoring your
                budget</span></a>
        <a href="#sr" target="_self" rel="noopener noreferrer"><span>AWS service restrictions</span></a>
        <a href="#scenario" target="_self" rel="noopener noreferrer"><span>Scenario</span></a>
        <a href="#sr" target="_self" rel="noopener noreferrer"><span>Solution requirements</span></a>
        <a href="#lpt" target="_self" rel="noopener noreferrer"><span>Lab project tips</span></a>
        <a href="#a" target="_self" rel="noopener noreferrer"><span>Approach</span></a>
        <a href="#p1" target="_self" rel="noopener noreferrer"><span>Phase 1: Planning the design and estimating
                cost</span></a>
        <span> </span><a href="#p1t1" target="_self" rel="noopener noreferrer"><span>Task 1.1: Create an architecture
                diagram</span></a>
        <span> </span><a href="#p1t2" target="_self" rel="noopener noreferrer"><span>Task 1.2: Develop a cost
                estimate</span></a>
        <a href="#p2" target="_self" rel="noopener noreferrer"><span>Phase 2: Analyzing the infrastructure of the
                monolithic application</span></a>
        <span> </span><a href="#p2t1" target="_self" rel="noopener noreferrer"><span>Task 2.1: Verify that the
                monolithic application is available</span></a>
        <span> </span><a href="#p2t2" target="_self" rel="noopener noreferrer"><span>Task 2.2: Test the monolithic web
                application</span></a>
        <span> </span><a href="#p2t3" target="_self" rel="noopener noreferrer"><span>Task 2.3: Analyze how the
                monolithic application runs</span></a>
        <a href="#p3" target="_self" rel="noopener noreferrer"><span>Phase 3: Creating a development environment and
                checking code into a Git repository</span></a>
        <span> </span><a href="#p3t1" target="_self" rel="noopener noreferrer"><span>Task 3.1: Create an AWS Cloud9 IDE
                as your work environment </span></a>
        <span> </span><a href="#p3t2" target="_self" rel="noopener noreferrer"><span>Task 3.2: Copy the application code
                to your IDE</span></a>
        <span> </span><a href="#p3t3" target="_self" rel="noopener noreferrer"><span>Task 3.3: Create working
                directories with starter code for the two microservices</span></a>
        <span> </span><a href="#p3t4" target="_self" rel="noopener noreferrer"><span>Task 3.4: Create a Git repository
                for the microservices code and push the code to CodeCommit</span></a>
        <a href="#p4" target="_self" rel="noopener noreferrer"><span>Phase 4: Configuring the application as two
                microservices and testing them in Docker containers</span></a>
        <span> </span><a href="#p4t1" target="_self" rel="noopener noreferrer"><span>Task 4.1: Adjust the AWS Cloud9
                instance security group settings</span></a>
        <span> </span><a href="#p4t2" target="_self" rel="noopener noreferrer"><span>Task 4.2: Modify the source code of
                the </span><em><span>customer</span></em><span> microservice</span></a>
        <span> </span><a href="#p4t3" target="_self" rel="noopener noreferrer"><span>Task 4.3: Create the
            </span><em><span>customer</span></em><span> microservice Dockerfile and launch a test container</span></a>
        <span> </span><a href="#p4t4" target="_self" rel="noopener noreferrer"><span>Task 4.4: Modify the source code of
                the </span><em><span>employee</span></em><span> microservice</span></a>
        <span> </span><a href="#p4t5" target="_self" rel="noopener noreferrer"><span>Task 4.5: Create the
            </span><em><span>employee</span></em><span> microservice Dockerfile and launch a test container</span></a>
        <span> </span><a href="#p4t6" target="_self" rel="noopener noreferrer"><span>Task 4.6: Adjust the
            </span><em><span>employee</span></em><span> microservice port and rebuild the image</span></a>
        <span> </span><a href="#p4t7" target="_self" rel="noopener noreferrer"><span>Task 4.7: Check code into
                CodeCommit</span></a>
        <a href="#p5" target="_self" rel="noopener noreferrer"><span>Phase 5: Creating ECR repositories, an ECS cluster,
                task definitions, and AppSpec files</span></a>
        <span> </span><a href="#p5t1" target="_self" rel="noopener noreferrer"><span>Task 5.1: Create ECR repositories
                and upload the Docker images</span></a>
        <span> </span><a href="#p5t2" target="_self" rel="noopener noreferrer"><span>Task 5.2: Create an ECS
                cluster</span></a>
        <span> </span><a href="#p5t3" target="_self" rel="noopener noreferrer"><span>Task 5.3: Create a CodeCommit
                repository to store deployment files</span></a>
        <span> </span><a href="#p5t4" target="_self" rel="noopener noreferrer"><span>Task 5.4: Create task definition
                files for each microservice and register them with Amazon ECS</span></a>
        <span> </span><a href="#p5t5" target="_self" rel="noopener noreferrer"><span>Task 5.5: Create AppSpec files for
                CodeDeploy for each microservice</span></a>
        <span> </span><a href="#p5t6" target="_self" rel="noopener noreferrer"><span>Task 5.6: Update files and check
                them into CodeCommit</span></a>
        <a href="#p6" target="_self" rel="noopener noreferrer"><span>Phase 6: Creating target groups and an Application
                Load Balancer</span></a>
        <span> </span><a href="#p6t1" target="_self" rel="noopener noreferrer"><span>Task 6.1: Create four target
                groups</span></a>
        <span> </span><a href="#p6t2" target="_self" rel="noopener noreferrer"><span>Task 6.2: Create a security group
                and an Application Load Balancer, and configure rules to route traffic</span></a>
        <a href="#p7" target="_self" rel="noopener noreferrer"><span>Phase 7: Creating two Amazon ECS
                services</span></a>
        <span> </span><a href="#p7t1" target="_self" rel="noopener noreferrer"><span>Task 7.1: Create the ECS service
                for the </span><em><span>customer</span></em><span> microservice</span></a>
        <span> </span><a href="#p7t2" target="_self" rel="noopener noreferrer"><span>Task 7.2: Create the Amazon ECS
                service for the </span><em><span>employee</span></em><span> microservice</span></a>
        <a href="#p8" target="_self" rel="noopener noreferrer"><span>Phase 8: Configuring CodeDeploy and
                CodePipeline</span></a>
        <span> </span><a href="#p8t1" target="_self" rel="noopener noreferrer"><span>Task 8.1: Create a CodeDeploy
                application and deployment groups</span></a>
        <span> </span><a href="#p8t2" target="_self" rel="noopener noreferrer"><span>Task 8.2: Create a pipeline for the
            </span><em><span>customer</span></em><span> microservice</span></a>
        <span> </span><a href="#p8t3" target="_self" rel="noopener noreferrer"><span>Task 8.3: Test the CI/CD pipeline
                for the </span><em><span>customer</span></em><span> microservice</span></a>
        <span> </span><a href="#p8t4" target="_self" rel="noopener noreferrer"><span>Task 8.4: Create a pipeline for the
            </span><em><span>employee</span></em><span> microservice</span></a>
        <span> </span><a href="#p8t5" target="_self" rel="noopener noreferrer"><span>Task 8.5: Test the CI/CD pipeline
                for the </span><em><span>employee</span></em><span> microservice</span></a>
        <span> </span><a href="#p8t6" target="_self" rel="noopener noreferrer"><span>Task 8.6: Observe how CodeDeploy
                modified the load balancer listener rules</span></a>
        <a href="#p9" target="_self" rel="noopener noreferrer"><span>Phase 9: Adjusting the microservice code to cause a
                pipeline to run again</span></a>
        <span> </span><a href="#p9t1" target="_self" rel="noopener noreferrer"><span>Task 9.1: Limit access to the
            </span><em><span>employee</span></em><span> microservice</span></a>
        <span> </span><a href="#p9t2" target="_self" rel="noopener noreferrer"><span>Task 9.2: Adjust the UI for the
            </span><em><span>employee</span></em><span> microservice and push the updated image to Amazon ECR</span></a>
        <span> </span><a href="#p9t3" target="_self" rel="noopener noreferrer"><span>Task 9.3: Confirm that the
            </span><em><span>employee</span></em><span> pipeline ran and the microservice was updated</span></a>
        <span> </span><a href="#p9t4" target="_self" rel="noopener noreferrer"><span>Task 9.4: Test access to the
            </span><em><span>employee</span></em><span> microservice</span></a>
        <span> </span><a href="#p9t5" target="_self" rel="noopener noreferrer"><span>Task 9.5: Scale the
            </span><em><span>customer</span></em><span> microservice</span></a>
        <a href="#app" target="_self" rel="noopener noreferrer"><span>Appendix</span></a>
        <span> </span><a href="#app1" target="_self" rel="noopener noreferrer"><span>Updating a test container running
                on Cloud9</span></a>
        <span> </span><a href="#app2" target="_self" rel="noopener noreferrer"><span>Reassociate Target Groups with Load
                Balancer</span></a>
        <span> </span><a href="#app3" target="_self" rel="noopener noreferrer"><span>Troubleshooting Tips</span></a>
    </p>
    <p>&nbsp;</p>
    <h2 id="a-idpoaoaproject-overview-and-objectives"><a id="poao"></a><span>Project overview and objectives</span></h2>
    <p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
    <p><span>In this project, you’re challenged to use at least 11 AWS offerings, including some that might be new to
            you, to build a microservices and continuous integration and continuous development (CI/CD) solution.
            Throughout various AWS Academy courses, you have completed hands-on labs. You have used different AWS
            services and features to build a variety of solutions.</span></p>
    <p><span>In many parts of the project, step-by-step guidance is </span><em><span>not</span></em><span> provided.
            This is intentional. These specific sections of the project are meant to challenge you to practice skills
            that you have acquired throughout your learning experiences prior to this project. In some cases, you might
            be challenged to use resources to independently learn new skills.</span></p>
    <p><span>By the end of this project, you should be able to do the following:</span></p>
    <ul>
        <li>
            <p><span>Recognize how a Node.js web application is coded and deployed to run and connect to a relational
                    database where the application data is stored.</span></p>
        </li>
        <li>
            <p><span>Create an AWS Cloud9 integrated development environment (IDE) and a code repository (repo) in which
                    to store the application code.</span></p>
        </li>
        <li>
            <p><span>Split the functionality of a monolithic application into separate containerized
                    microservices.</span></p>
        </li>
        <li>
            <p><span>Use a container registry to store and version control containerized microservice Docker
                    images.</span></p>
        </li>
        <li>
            <p><span>Create code repositories to store microservice source code and CI/CD deployment assets.</span></p>
        </li>
        <li>
            <p><span>Create a serverless cluster to fulfill cost optimization and scalability solution
                    requirements.</span></p>
        </li>
        <li>
            <p><span>Configure an Application Load Balancer and multiple target groups to route traffic between
                    microservices.</span></p>
        </li>
        <li>
            <p><span>Create a code pipeline to deploy microservices containers to a blue/green cluster
                    deployment.</span></p>
        </li>
        <li>
            <p><span>Use the code pipeline and code repository for CI/CD by iterating on the application design.</span>
            </p>
        </li>
    </ul>
    <h2 id="a-idleathe-lab-environment-and-monitoring-your-budget"><a id="le"></a><span>The lab environment and
            monitoring your budget</span></h2>
    <p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
    <p><strong><span>This environment is long lived</span></strong><span>. When the session timer runs to 0:00, the
            session will end, but any data and resources that you created in the AWS account will be retained. If you
            later launch a new session (for example, the next day), you will find that your work is still in the lab
            environment. Also, at any point before the session timer reaches 0:00, you can choose
        </span><strong><span>Start Lab</span></strong><span> again to extend the current session time. </span></p>
    <p><i class="fa-solid fa-circle-exclamation" aria-label="Important icon"></i><span>
        </span><strong><span>Important:</span></strong><span> Monitor your lab budget in the lab interface. When you
            have an active lab session, the latest known remaining budget information displays at the top of this
            screen. The remaining budget that you see might not reflect your most recent account activity. If you exceed
            your lab budget, your lab account will be disabled, and all progress and resources will be lost. If you
            exceed the budget, please contact your educator for assistance.</span></p>
    <p><span>If you ever want to reset the lab environment to the original state, before you started the lab, use the
        </span><strong><span>Reset</span></strong><span> option above these instructions. Note that this won't reset
            your budget. </span><i class="fas fa-exclamation-triangle" style="color:red"></i><span>
        </span><strong><span>Warning:</span></strong><span> If you reset the environment, you will
        </span><em><span>permanently delete</span></em><span> everything that you have created or stored in this AWS
            account.</span></p>
    <h2 id="a-idsraaws-service-restrictions"><a id="sr"></a><span>AWS service restrictions</span></h2>
    <p><span>In this lab environment, access to AWS services and service actions are restricted to the ones that are
            needed to complete the project. You might encounter errors if you attempt to access other services or
            perform actions beyond the ones that are described in this lab.</span></p>
    <h2 id="a-idscenarioascenario"><a id="scenario"></a><span>Scenario</span></h2>
    <p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
    <p><span>The owners of a café corporation with many franchise locations have noticed how popular their gourmet
            coffee offerings have become. </span></p>
    <p><em><span>Customers</span></em><span> (the café franchise location managers) cannot seem to get enough of the
            high-quality coffee beans that are needed to create amazing cappuccinos and lattes in their cafés. </span>
    </p>
    <p><span>Meanwhile, the </span><em><span>employees</span></em><span> in the café corporate office have been
            challenged to consistently source the highest-quality coffee beans. Recently, the leaders at the corporate
            office learned that one of their favorite coffee suppliers wants to sell her company. The café corporate
            managers jumped at the opportunity to buy the company. The acquired coffee supplier runs a coffee supplier
            listings application on an AWS account, as shown in the following image.</span></p>
    <p><img src="images/scenario-one.png" referrerpolicy="no-referrer" alt="scenario"></p>
    <p><span>The coffee suppliers application currently runs as a </span><em><span>monolithic</span></em><span>
            application. It has reliability and performance issues. That is one of the reasons that you have recently
            been hired to work in the café corporate office. In this project, you perform tasks that are associated with
            software development engineer (SDE), app developer, and cloud support engineer roles.</span></p>
    <p><span>You have been tasked to split the monolithic application into
        </span><em><span>microservices</span></em><span>, so that you can scale the services independently and allocate
            more compute resources to the services that experience the highest demand, with the goal of avoiding
            bottlenecks. A microservices design will also help avoid single points of failure, which could bring down
            the entire application in a monolithic design. With services isolated from one another, if one microservice
            becomes temporarily unavailable, the other microservices might remain available.</span></p>
    <p><span>You have also been challenged to develop a CI/CD pipeline to automatically deploy updates to the production
            cluster that runs containers, using a blue/green deployment strategy. </span></p>
    <p>&nbsp;</p>
    <h2 id="a-idsrasolution-requirements"><a id="sr"></a><span>Solution requirements</span></h2>
    <p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
    <p><span>The solution must meet the following requirements:</span></p>
    <ul>
        <li>
            <p><span>R1 - Design: The solution must have an architecture diagram.</span></p>
        </li>
        <li>
            <p><span>R2 - Cost optimized: The solution must include a cost estimate.</span></p>
        </li>
        <li>
            <p><span>R3 - Microservices-based architecture: Ensure that the solution is functional and deploys a
                    microservice-based architecture.</span></p>
        </li>
        <li>
            <p><span>R4 - Portability: The solution must be portable so that the application code isn't tied to running
                    on a specific host machine.</span></p>
        </li>
        <li>
            <p><span>R5 - Scalability/resilience: The solution must provide the ability to increase the amount of
                    compute resources that are dedicated to serving requests as usage patterns change, and the solution
                    must use routing logic that is reliable and scalable.</span></p>
        </li>
        <li>
            <p><span>R6 - Automated CI/CD: The solution must provide a CI/CD pipeline that can be automatically invoked
                    when code is updated and pushed to a version-controlled code repository.</span></p>
        </li>
    </ul>
    <h2 id="a-idlptalab-project-tips"><a id="lpt"></a><span>Lab project tips</span></h2>
    <p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
    <p><span>Knowledge of Linux Bash commands would be helpful, but it isn't mandatory. </span></p>
    <p><i class="fa-solid fa-lightbulb" aria-label="Tip icon"></i><span> </span><strong><span>Tip:</span></strong><span>
            One online Linux Bash reference is the </span><a href="https://linux.die.net/man" target="_blank"
            rel="noopener noreferrer"><span>Linux Man Pages on linux.die.net</span></a><span>. You can search or browse
            for commands to learn more about them.</span></p>
    <p><span>Finally, you are encouraged to be resourceful as you complete this project. For example, reference the
        </span><a href="https://docs.aws.amazon.com" target="_blank" rel="noopener noreferrer"><span>AWS
                Documentation</span></a><span> or a search engine if you need an answer to a technical question.</span>
    </p>
    <p><span>As you work through the project, you will find other tips to help you complete specific phases or
            tasks.</span></p>
    <h2 id="a-idaaapproach"><a id="a"></a><span>Approach</span></h2>
    <p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
    <p><span>The following table describes the phases of the project:</span></p>
    <figure class="table-figure">
        <table>
            <thead>
                <tr>
                    <th><span>Phase</span></th>
                    <th><span>Detail</span></th>
                    <th><span>Solution requirement</span></th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><span>1</span></td>
                    <td><span>Create an architecture diagram and cost estimate for the solution.</span></td>
                    <td><span>R1, R2</span></td>
                </tr>
                <tr>
                    <td><span>2</span></td>
                    <td><span>Analyze the design of the monolithic application and test the application.</span></td>
                    <td><span>R3</span></td>
                </tr>
                <tr>
                    <td><span>3</span></td>
                    <td><span>Create a development environment on AWS Cloud9, and check the monolithic source code into
                            CodeCommit.</span></td>
                    <td><span>R3</span></td>
                </tr>
                <tr>
                    <td><span>4</span></td>
                    <td><span>Break the monolithic design into microservices, and launch test Docker containers.</span>
                    </td>
                    <td><span>R3, R4</span></td>
                </tr>
                <tr>
                    <td><span>5</span></td>
                    <td><span>Create ECR repositories to store Docker images. Create an ECS cluster, ECS task
                            definitions, and CodeDeploy application specification files.</span></td>
                    <td><span>R3</span></td>
                </tr>
                <tr>
                    <td><span>6</span></td>
                    <td><span>Create target groups and an Application Load Balancer that routes web traffic to
                            them.</span></td>
                    <td><span>R5</span></td>
                </tr>
                <tr>
                    <td><span>7</span></td>
                    <td><span>Create ECS services.</span></td>
                    <td><span>R5</span></td>
                </tr>
                <tr>
                    <td><span>8</span></td>
                    <td><span>Configure applications and deployments groups in CodeDeploy, and create two CI/CD
                            pipelines by using CodePipeline.</span></td>
                    <td><span>R5, R6</span></td>
                </tr>
                <tr>
                    <td><span>9</span></td>
                    <td><span>Modify your microservices and scale capacity, and use the pipelines that you created to
                            deploy iterative improvements to production by using a blue/green deployment
                            strategy.</span></td>
                    <td><span>R5, R6</span></td>
                </tr>
            </tbody>
        </table>
    </figure>
    <h2 id="a-idp1aphase-1-planning-the-design-and-estimating-cost"><a id="p1"></a><span>Phase 1: Planning the design
            and estimating cost</span></h2>
    <p><span>In this phase, you will plan the design of your architecture. First, you will create an architecture
            diagram.</span></p>
    <p><span>You will also estimate the cost of the proposed solution and present the estimate to your educator. An
            important first step for any solution is to plan the design and estimate the cost. Review the various
            components in the architecture to adjust the estimated cost. Cost, along with the features and limitations
            of specific AWS services, is an important factor when you build a solution.</span></p>
    <h3 id="a-idp1t1atask-11-create-an-architecture-diagram"><a id="p1t1"></a><span>Task 1.1: Create an architecture
            diagram</span></h3>
    <p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
    <ol start="">
        <li>
            <p><span>Create an architectural diagram to illustrate what you plan to build. Consider how you will
                    accomplish each requirement in the solution. Read through the phases in this document to be aware of
                    which AWS services and features you have been asked to use. Be sure to include the following
                    services or resources in your diagram:</span></p>
            <ul>
                <li>
                    <p><span>Amazon Virtual Private Cloud (Amazon VPC)</span></p>
                </li>
                <li>
                    <p><span>Amazon EC2: Instances, Application Load Balancer, target groups</span></p>
                </li>
                <li>
                    <p><span>AWS CodeCommit: Repository</span></p>
                </li>
                <li>
                    <p><span>AWS CodeDeploy</span></p>
                </li>
                <li>
                    <p><span>AWS CodePipeline: Pipeline</span></p>
                </li>
                <li>
                    <p><span>Amazon Elastic Container Service (Amazon ECS): Services, containers, tasks</span></p>
                </li>
                <li>
                    <p><span>Amazon Elastic Container Registry (Amazon ECR): Repository</span></p>
                </li>
                <li>
                    <p><span>AWS Cloud9 environment</span></p>
                </li>
                <li>
                    <p><span>AWS Identity and Access Management (IAM): Roles</span></p>
                </li>
                <li>
                    <p><span>Amazon Relational Database Service (Amazon RDS)</span></p>
                </li>
                <li>
                    <p><span>Amazon CloudWatch: Logs</span></p>
                </li>
            </ul>
        </li>
    </ol>
    <p><strong><span>References</span></strong></p>
    <ul>
        <li>
            <p><a href="https://aws.amazon.com/architecture/icons/" target="_blank" rel="noopener noreferrer"><span>AWS
                        Architecture Icons</span></a><span>: This site provides tools to draw AWS architecture
                    diagrams.</span></p>
        </li>
        <li>
            <p><a href="https://aws.amazon.com/architecture/reference-architecture-diagrams" target="_blank"
                    rel="noopener noreferrer"><span>AWS Reference Architecture Diagrams</span></a><span>: This site
                    provides a list of AWS architecture diagrams for various use cases. You might want to use these
                    diagrams as references.</span></p>
            <p>&nbsp;</p>
        </li>
    </ul>
    <h3 id="a-idp1t2atask-12-develop-a-cost-estimate"><a id="p1t2"></a><span>Task 1.2: Develop a cost estimate</span>
    </h3>
    <p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
    <p><span>Develop a cost estimate that shows the cost to run the solution that you created an architecture diagram
            for. Assume that the solution will run in the us-east-1 Region for 12 months. Use the </span><a
            href="https://calculator.aws" target="_blank" rel="noopener noreferrer"><span>AWS Pricing
                Calculator</span></a><span> for this estimate.</span></p>
    <p><span>If instructed by your educator, complete these additional requirements:</span></p>
    <ul>
        <li>
            <p><span>Add your architectural diagram and cost estimate to presentation slides. Your educator might want
                    to evaluate this information as part of assessing your work on this project. A presentation template
                    is provided.</span></p>
        </li>
        <li>
            <p><span>Capture screenshots of your work at the end of each task or phase to include in the presentation or
                    document. Your instructor might use the presentation or document to help assess how well you
                    completed the project requirements.</span></p>
        </li>
    </ul>
    <p><strong><span>Reference</span></strong></p>
    <ul>
        <li>
            <p><span>A PowerPoint presentation template is available to you in the course materials.</span></p>
        </li>
    </ul>
    <h2 id="a-idp2aphase-2-analyzing-the-infrastructure-of-the-monolithic-application"><a id="p2"></a><span>Phase 2:
            Analyzing the infrastructure of the monolithic application</span></h2>
    <p><span>In this task, you will analyze the current application infrastructure and then test the web
            application.</span></p>
    <h3 id="a-idp2t1atask-21-verify-that-the-monolithic-application-is-available"><a id="p2t1"></a><span>Task 2.1:
            Verify that the monolithic application is available</span></h3>
    <p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
    <p>&nbsp;</p>
    <ol start="">
        <li>
            <p><span>Verify that the monolithic web application is accessible from the internet. </span></p>
            <ul>
                <li>
                    <p><span>Navigate to the Amazon EC2 console.</span></p>
                </li>
                <li>
                    <p><span>Copy the Public IPv4 address of the </span><em><span>MonolithicAppServer</span></em><span>
                            instance, and load it in a new browser tab.</span></p>
                    <p><span>The coffee suppliers website displays.</span></p>
                </li>
            </ul>
            <p><i class="fa-solid fa-note-sticky" aria-label="Note icon"></i><span>
                </span><strong><span>Note:</span></strong><span> The page is available at
                </span><code>http://</code><span> instead of </span><code>https://</code><span>. Your browser might
                    indicate that the site isn't secure because it doesn't have a valid SSL/TLS certificate. You can
                    ignore the warning in this development environment.</span></p>
            <p>&nbsp;</p>
        </li>
    </ol>
    <h3 id="a-idp2t2atask-22-test-the-monolithic-web-application"><a id="p2t2"></a><span>Task 2.2: Test the monolithic
            web application</span></h3>
    <p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
    <p><span>In this task, you add data to the web application, test the functionality, and observe the different URL
            paths that are used to display the different pages. These URL paths are important to understand for when you
            divide this application into microservices later.</span></p>
    <p>&nbsp;</p>
    <ol start="">
        <li>
            <p><span>Choose </span><strong><span>List of suppliers</span></strong><span>.</span></p>
            <p><span>Notice that the URL path includes </span><code>/suppliers</code><span>.</span></p>
        </li>
        <li>
            <p><span>Add a new supplier.</span></p>
            <ul>
                <li>
                    <p><span>On the page where you add a new supplier, notice that the URL path includes
                        </span><code>/supplier-add</code><span>.</span></p>
                </li>
                <li>
                    <p><span>Fill in all of the fields to create a supplier entry.</span></p>
                </li>
            </ul>
        </li>
    </ol>
    <ol start="3">
        <li>
            <p><span>Edit an entry.</span></p>
            <ul>
                <li>
                    <p><span>On the page where you edit a supplier entry, notice that the URL path now includes
                        </span><code>supplier-update/1</code><span>.</span></p>
                </li>
                <li>
                    <p><span>Modify the record in some way and save the change.</span></p>
                    <p><span>Notice that the change was saved in the record.</span></p>
                    <p>&nbsp;</p>
                </li>
            </ul>
        </li>
    </ol>
    <h3 id="a-idp2t3atask-23-analyze-how-the-monolithic-application-runs"><a id="p2t3"></a><span>Task 2.3: Analyze how
            the monolithic application runs</span></h3>
    <p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
    <p>&nbsp;</p>
    <ol start="">
        <li>
            <p><span>Use EC2 Instance Connect to connect to the </span><em><span>MonolithicAppServer</span></em><span>
                    instance.</span></p>
        </li>
        <li>
            <p><span>Analyze how the application is running.</span></p>
            <ul>
                <li>
                    <p><span>In the terminal session, run the following command:</span></p>
                    <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false"
                        lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">sudo</span> lsof <span class="cm-attribute">-i</span> :80</span></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div
    style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;">
</div>
<div class="CodeMirror-gutters" style="display: none; height: 22px;"></div>
</div>
</div>
</pre>
<p><span>What did you notice in the command output? What port and protocol is the
    </span><em><span>node</span></em><span> daemon using?</span></p>
</li>
<li>
    <p><span>Next, run the following command:</span></p>
    <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false"
        lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">ps</span> <span class="cm-attribute">-ef</span> | head <span class="cm-attribute">-1</span>; <span class="cm-builtin">ps</span> <span class="cm-attribute">-ef</span> | <span class="cm-builtin">grep</span> <span class="cm-builtin">node</span></span></pre>
    </div>
    </div>
    </div>
    </div>
    </div>
    </div>
    <div
        style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;">
    </div>
    <div class="CodeMirror-gutters" style="display: none; height: 22px;"></div>
    </div>
    </div>
    </pre>
    <p><span>What did you notice in the command output? Which user on this EC2 instance is running a
        </span><em><span>node</span></em><span> process? Does the node process ID (PID) match any of the PIDs from the
            output of the command that you ran before the last one?</span></p>
</li>
</ul>
</li>
<li>
    <p><span>To analyze the application structure, run the following commands:</span></p>
    <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false"
        lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">cd</span> ~/resources/codebase_partner</span></pre>
    </div>
    <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">ls</span></span></pre>
    </div>
    </div>
    </div>
    </div>
    </div>
    <div
        style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 44px;">
    </div>
    <div class="CodeMirror-gutters" style="display: none; height: 44px;"></div>
    </div>
    </div>
    </pre>
    <p><span>This is where the index.js file exists. It contains the base application logic, which you will look at in
            detail in a moment.</span></p>
    <p><strong><span>Questions for thought:</span></strong><span> Based on what you have observed, what can you
            determine about how and where this node application is running? How do you think it was installed? What
            prerequisite libraries, if any, were required to make it run? Where does the application store data?</span>
    </p>
</li>
<li>
    <p><span>Connect a MySQL client to the RDS database that the node application stores data in.</span></p>
    <ul>
        <li>
            <p><span>Find and copy the endpoint of the RDS database that is running in the lab environment.</span></p>
        </li>
        <li>
            <p><span>To verify that the database can be reached from the
                </span><em><span>MonolithicAppServer</span></em><span> instance on the standard MySQL port number, use
                    the </span><code>nmap -Pn</code><span> command with the RDS database endpoint that you
                    copied.</span></p>
        </li>
        <li>
            <p><span>To connect to the database, use the MySQL client that is already installed on the
                </span><em><span>MonolithicAppServer</span></em><span> instance. Use the following values:</span></p>
            <ul>
                <li>
                    <p><strong><span>Username:</span></strong><span> </span><code>admin</code></p>
                </li>
                <li>
                    <p><strong><span>Password:</span></strong><span> </span><code>lab-password</code></p>
                </li>
            </ul>
        </li>
    </ul>
</li>
<li>
    <p><span>Observe the data in the database.</span></p>
    <ul>
        <li>
            <p><span>From the </span><code>mysql&gt;</code><span> prompt, run SQL commands as appropriate to see that a
                    database named </span><em><span>COFFEE</span></em><span> contains a table named
                </span><em><span>suppliers</span></em><span>.</span></p>
            <p><span>This table contains the supplier entry or entries that you added earlier when you tested the web
                    application.</span></p>
        </li>
        <li>
            <p><span>Exit the MySQL client and then close the EC2 Instance Connect tab. Also close the coffee suppliers
                    web application tab.</span></p>
        </li>
    </ul>
</li>
</ol>
<p><span> </span></p>
<p><strong><span>References</span></strong></p>
<ul>
    <li>
        <p><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/Connect-using-EC2-Instance-Connect.html"
                target="_blank" rel="noopener noreferrer"><span>Connect to Your Linux Instance with EC2 Instance
                    Connect</span></a></p>
    </li>
    <li>
        <p><a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_ConnectToInstance.html#USER_ConnectToInstance.CLI"
                target="_blank" rel="noopener noreferrer"><span>Connecting from the MySQL Command-Line Client
                    (Unencrypted)</span></a></p>
    </li>
    <li>
        <p><span>For information about the lsof, ps, grep, and nmap commands, see the </span><a
                href="https://linux.die.net/man" target="_blank" rel="noopener noreferrer"><span>Linux Man Pages on
                    linux.die.net</span></a><span>.</span></p>
    </li>
</ul>
<p>&nbsp;</p>
<h2 id="a-idp3aphase-3-creating-a-development-environment-and-checking-code-into-a-git-repository"><a
        id="p3"></a><span>Phase 3: Creating a development environment and checking code into a Git repository</span>
</h2>
<p><span>In this phase, you will create a development environment by using AWS Cloud9. You will also check your
        application code into AWS CodeCommit, which is a Git-compatible repository.</span></p>
<h3 id="a-idp3t1atask-31-create-an-aws-cloud9-ide-as-your-work-environment"><a id="p3t1"></a><span>Task 3.1: Create an
        AWS Cloud9 IDE as your work environment</span></h3>
<p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
<p><span>In this task, you will create your development environment. If you aren't familiar with AWS Cloud9, the
        following references might be helpful:</span></p>
<ul>
    <li>
        <p><a href="https://docs.aws.amazon.com/cloud9/latest/user-guide/create-environment.html" target="_blank"
                rel="noopener noreferrer"><span>Creating an Environment in AWS Cloud9</span></a></p>
    </li>
    <li>
        <p><a href="https://docs.aws.amazon.com/cloud9/latest/user-guide/tour-ide.html" target="_blank"
                rel="noopener noreferrer"><span>Tour of the AWS Cloud9 IDE</span></a></p>
        <p>&nbsp;</p>
    </li>
</ul>
<ol start="">
    <li>
        <p><span>Create an AWS Cloud9 instance that is named </span><code>MicroservicesIDE</code><span> and then open
                the IDE.</span></p>
        <p><span>It should run as a new EC2 instance of size </span><em><span>t3.small</span></em><span> and run Amazon
                Linux 2. The instance should support SSH connections and run in the
            </span><em><span>LabVPC</span></em><span> in </span><em><span>Public Subnet1</span></em><span>.</span></p>
        <p>&nbsp;</p>
    </li>
</ol>
<h3 id="a-idp3t2atask-32-copy-the-application-code-to-your-ide"><a id="p3t2"></a><span>Task 3.2: Copy the application
        code to your IDE</span></h3>
<p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
<p><span>In this task, you will copy the source code for the monolithic application to your development
        environment.</span></p>
<ol start="">
    <li>
        <p><span>From the </span><strong><span>AWS Details</span></strong><span> panel on this lab instructions page,
                download the </span><strong><span>labsuser.pem</span></strong><span> file to your local computer.</span>
        </p>
    </li>
    <li>
        <p><span>Upload the .pem file to your AWS Cloud9 IDE, and use the Linux </span><code>chmod</code><span> command
                to set the </span><a
                href="https://repost.aws/questions/QUsZqMJGVtQmemkEMVwxUiIw/why-should-i-change-the-permissions-on-the-ssh-pem-file"
                target="_blank" rel="noopener noreferrer"><span>proper permissions</span></a><span> on the file so that
                you can use it to connect to an EC2 instance.</span></p>
    </li>
    <li>
        <p><span>Create a temp directory on the AWS Cloud9 instance at
            </span><code>/home/ec2-user/environment/temp</code><span>.</span></p>
    </li>
    <li>
        <p><span>From the Amazon EC2 console, retrieve the private IPv4 address of the
            </span><em><span>MonolithicAppServer</span></em><span> instance.</span></p>
    </li>
    <li>
        <p><span>Use the Linux </span><a
                href="https://docs.aws.amazon.com/managedservices/latest/appguide/qs-file-transfer.html" target="_blank"
                rel="noopener noreferrer"><code>scp</code></a><span> command in the Bash terminal on the AWS Cloud9
                instance to copy the source code for the node application from the
            </span><em><span>MonolithicAppServer</span></em><span> instance to the temp directory that you created on
                the AWS Cloud9 instance.</span></p>
        <p><span>The following snippet provides an example scp command:</span></p>
        <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false"
            lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">scp <span class="cm-attribute">-r</span> <span class="cm-attribute">-i</span> ~/environment/labsuser.pem ubuntu@<span class="cm-def">$appServerPrivIp</span>:/home/ubuntu/resources/codebase_partner/* ~/environment/temp/</span></pre>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        <div
            style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 44px;">
        </div>
        <div class="CodeMirror-gutters" style="display: none; height: 44px;"></div>
        </div>
        </div>
        </pre>
    </li>
    <li>
        <p><span>In the file browser of the IDE, verify that the source files for the application have been copied to
                the temp directory on the AWS Cloud9 instance.</span></p>
        <p>&nbsp;</p>
    </li>
</ol>
<h3 id="a-idp3t3atask-33-create-working-directories-with-starter-code-for-the-two-microservices"><a
        id="p3t3"></a><span>Task 3.3: Create working directories with starter code for the two microservices</span></h3>
<p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
<p><span>In this task, you will create areas in your development environment to support separating the application logic
        into two different microservices.</span></p>
<p><span>Based on the solution requirements of this project, it makes sense to split the monolithic application into two
        microservices. You will name the microservices </span><em><span>customer</span></em><span> and
    </span><em><span>employee</span></em><span>.</span></p>
<p><span>The following table explains the functionality that is needed for each microservice.</span></p>
<figure class="table-figure">
    <table>
        <thead>
            <tr>
                <th><span>Primary User</span></th>
                <th><span>Microservice Functionality</span></th>
                <th><span>Access Level</span></th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><span>Customer</span></td>
                <td><span>The </span><em><span>customer</span></em><span> microservice will provide the functionality
                        that customers (the café franchise location managers who want to buy coffee beans) need. The
                        customers need a read-only view of the contact information for the suppliers to be able to buy
                        coffee beans from them. You can think of the café franchise location managers as
                    </span><em><span>customers</span></em><span> of the application.</span></td>
                <td><span>Read-only</span></td>
            </tr>
            <tr>
                <td><span>Employee</span></td>
                <td><span>The </span><em><span>employee</span></em><span> microservice will provide the functionality
                        that employees (the café corporate office employees) need. Employees need to add, modify, and
                        delete suppliers who are listed in the application. Employees are responsible for keeping the
                        listings accurate and up to date.</span></td>
                <td><span>Read-write</span></td>
            </tr>
        </tbody>
    </table>
</figure>
<p>&nbsp;</p>
<p><img src="images/splitting-of-features.png" referrerpolicy="no-referrer" alt="features"></p>
<p><span>The employee microservice will eventually be made available only to employees. You will accomplish this by
        first encapsulating them as a separate microservice (in phases 3 and 4 of the project), and then later in phase
        9 of the project, you will limit who can access the employee microservice.</span></p>
<p>&nbsp;</p>
<ol start="">
    <li>
        <p><span>In the </span><strong><span>microservices</span></strong><span> directory, create two new directories
                that are named </span><code>customer</code><span> and </span><code>employee</code><span>.</span></p>
        <p><span>Verify that your directory structure matches the following image:</span></p>
        <p><img src="images/view1.png" referrerpolicy="no-referrer"
                alt="Cloud9 file panel showing the new directories."></p>
    </li>
    <li>
        <p><span>Place a copy of the source code for the monolithic application in each new directory, and remove the
                files from the </span><strong><span>temp</span></strong><span> directory.</span></p>
        <p><span>Verify that your directory structure matches the following image:</span></p>
        <p><img src="images/view2.png" referrerpolicy="no-referrer"
                alt="Cloud9 file panel showing the source code files in each new directory."></p>
    </li>
    <li>
        <p><span>Delete the empty </span><strong><span>temp</span></strong><span> directory.</span></p>
    </li>
</ol>
<p>&nbsp;</p>
<h3 id="a-idp3t4atask-34-create-a-git-repository-for-the-microservices-code-and-push-the-code-to-codecommit"><a
        id="p3t4"></a><span>Task 3.4: Create a Git repository for the microservices code and push the code to
        CodeCommit</span></h3>
<p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
<p><span>You now have directories named </span><em><span>customer</span></em><span> and
    </span><em><span>employee</span></em><span>, and each will contain a microservice. The two microservices will
        replicate the logic in your monolithic application. However, you will also be able to evolve the application
        functionality and to time the deployment of feature enhancements for these microservices separately.</span></p>
<p><span>You will benefit from checking this source code into a Git repository. In this project, you will use CodeCommit
        as your Git repository (repo).</span></p>
<p>&nbsp;</p>
<ol start="">
    <li>
        <p><span>Create a CodeCommit repository that is named </span><code>microservices</code><span>.</span></p>
    </li>
    <li>
        <p><span>To check the unmodified application code into the microservices CodeCommit repository, run the
                following commands:</span></p>
        <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false"
            lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">cd</span> ~/environment/microservices</span></pre>
        </div>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">git</span> init</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">git</span> branch <span class="cm-attribute">-m</span> dev </span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">git</span> add .</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">git</span> commit <span class="cm-attribute">-m</span> <span class="cm-string">'two unmodified copies of the application code'</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">git</span> remote add origin https://git-codecommit.us-east-1.amazonaws.com/v1/repos/microservices</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">git</span> push <span class="cm-attribute">-u</span> origin dev</span></pre>
        </div>
        </div>
        </div>
        </div>
        </div>
        <div
            style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 176px;">
        </div>
        <div class="CodeMirror-gutters" style="display: none; height: 176px;"></div>
        </div>
        </div>
        </pre>
        <p><i class="fa-solid fa-lightbulb" aria-label="Tip icon"></i><span>
            </span><strong><span>Tip:</span></strong><span> For information about Git commands, see the </span><a
                href="https://git-scm.com/docs" target="_blank" rel="noopener noreferrer"><span>Git
                    documentation</span></a><span>.</span></p>
        <p><strong><span>Analysis:</span></strong><span> By running these commands, you first
            </span><em><span>initialized</span></em><span> the microservices directory to be a Git repository. Then, you
                created a </span><em><span>branch</span></em><span> in the repository named
            </span><em><span>dev</span></em><span>. You </span><em><span>added</span></em><span> all files from the
                microservices directory to the Git repository and </span><em><span>committed</span></em><span> them.
                Then, you defined the microservices repository that you created in CodeCommit as the
            </span><em><span>remote origin</span></em><span> of this Git repository area on your IDE. Finally, you
            </span><em><span>pushed</span></em><span> the changes that were committed in the
            </span><em><span>dev</span></em><span> branch to the remote origin.</span></p>
    </li>
    <li>
        <p><span>Configure your Git client to know your username and email address.</span></p>
        <p><i class="fa-solid fa-lightbulb" aria-label="Tip icon"></i><span>
            </span><strong><span>Tip:</span></strong><span> For information about the commands that you need to use, see
            </span><a href="https://git-scm.com/book/en/v2/Getting-Started-First-Time-Git-Setup" target="_blank"
                rel="noopener noreferrer"><span>Getting Started - First-Time Git Setup</span></a><span>.</span></p>
        <p><i class="fa-solid fa-note-sticky" aria-label="Note icon"></i><span>
            </span><strong><span>Note:</span></strong><span> You don't need to use your real name or email address;
                however, completing this step is an important part of configuring a Git client.</span></p>
    </li>
    <li>
        <p><span>In a new browser tab, browse to the CodeCommit console and observe that the code is now checked into
                your microservices repository.</span></p>
        <p>&nbsp;</p>
    </li>
</ol>
<h2 id="a-idp4aphase-4-configuring-the-application-as-two-microservices-and-testing-them-in-docker-containers"><a
        id="p4"></a><span>Phase 4: Configuring the application as two microservices and testing them in Docker
        containers</span></h2>
<p><span>In this phase, you will modify the two copies of the monolithic application starter code so that the
        application functionality is implemented as two separate microservices. Then, for initial testing purposes, you
        will run the containers on the same EC2 instance that hosts the AWS Cloud9 IDE that you are using. You will use
        this IDE to build the Docker images and launch the Docker containers.</span></p>
<h3 id="a-idp4t1atask-41-adjust-the-aws-cloud9-instance-security-group-settings"><a id="p4t1"></a><span>Task 4.1: Adjust
        the AWS Cloud9 instance security group settings</span></h3>
<p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
<p><span>In this phase of the project, you will use the AWS Cloud9 instance as your test environment. You will run
        Docker containers on the instance to test the microservices that you will create. To be able to access the
        containers from a browser over the internet, you must open the ports that you will run the containers on.</span>
</p>
<p>&nbsp;</p>
<ol start="">
    <li>
        <p><span>Adjust the security group of the AWS Cloud9 EC2 instance to allow inbound network traffic on TCP ports
                8080 and 8081.</span></p>
        <p>&nbsp;</p>
    </li>
</ol>
<h3 id="a-idp4t2atask-42-modify-the-source-code-of-the-customer-microservice"><a id="p4t2"></a><span>Task 4.2: Modify
        the source code of the </span><em><span>customer</span></em><span> microservice</span></h3>
<p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
<p><span>In this task, you will edit the source code for the </span><em><span>customer</span></em><span> microservice.
        Recall that the source code you are starting with is an exact copy of the monolithic application. Therefore, it
        still has features in it that will be handled by the employee microservice and that you don't want as part of
        the customer microservice. Specifically, customers shouldn't have the ability to add, edit, or delete suppliers;
        therefore, the changes that you make will remove that functionality from the source code. Ideally, the source
        code should contain only code that is needed.</span></p>
<p>&nbsp;</p>
<ol start="">
    <li>
        <p><span>In the AWS Cloud9 file panel, </span><em><span>collapse</span></em><span> the
            </span><strong><span>employee</span></strong><span> directory, if it is expanded, and then
            </span><em><span>expand</span></em><span> the </span><strong><span>customer</span></strong><span>
                directory.</span></p>
    </li>
    <li>
        <p><span>Edit the customer/app/controller/</span><strong><span>supplier.controller.js</span></strong><span> file
                so that the remaining functions provide only the read-only actions that you want customers to be able to
                perform.</span></p>
        <p><i class="fa-solid fa-lightbulb" aria-label="Tip icon"></i><span>
            </span><strong><span>Tip:</span></strong><span> After you edit the file, it should contain only the
                following lines:</span></p>
        <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="javascript"
            style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="javascript"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-keyword">const</span> <span class="cm-def">Supplier</span> <span class="cm-operator">=</span> <span class="cm-variable">require</span>(<span class="cm-string">"../models/supplier.model.js"</span>);</span></pre>
        </div>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-keyword">const</span> {<span class="cm-def">body</span>, <span class="cm-def">validationResult</span>} <span class="cm-operator">=</span> <span class="cm-variable">require</span>(<span class="cm-string">"express-validator"</span>);</span></pre>
        <pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
    </span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-variable">exports</span>.<span class="cm-property">findAll</span> <span class="cm-operator">=</span> (<span class="cm-def">req</span>, <span class="cm-def">res</span>) <span class="cm-operator">=&gt;</span> {</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-variable">Supplier</span>.<span class="cm-property">getAll</span>((<span class="cm-def">err</span>, <span class="cm-def">data</span>) <span class="cm-operator">=&gt;</span> {</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">if</span> (<span class="cm-variable-2">err</span>)</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable-2">res</span>.<span class="cm-property">render</span>(<span class="cm-string">"500"</span>, {<span class="cm-property">message</span>: <span class="cm-string">"The was a problem retrieving the list of suppliers"</span>});</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">else</span> <span class="cm-variable-2">res</span>.<span class="cm-property">render</span>(<span class="cm-string">"supplier-list-all"</span>, {<span class="cm-property">suppliers</span>: <span class="cm-variable-2">data</span>});</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; });</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> };</span></pre>
        <pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
    </span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-variable">exports</span>.<span class="cm-property">findOne</span> <span class="cm-operator">=</span> (<span class="cm-def">req</span>, <span class="cm-def">res</span>) <span class="cm-operator">=&gt;</span> {</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-variable">Supplier</span>.<span class="cm-property">findById</span>(<span class="cm-variable-2">req</span>.<span class="cm-property">params</span>.<span class="cm-property">id</span>, (<span class="cm-def">err</span>, <span class="cm-def">data</span>) <span class="cm-operator">=&gt;</span> {</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">if</span> (<span class="cm-variable-2">err</span>) {</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">if</span> (<span class="cm-variable-2">err</span>.<span class="cm-property">kind</span> <span class="cm-operator">===</span> <span class="cm-string">"not_found"</span>) {</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable-2">res</span>.<span class="cm-property">status</span>(<span class="cm-number">404</span>).<span class="cm-property">send</span>({</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-property">message</span>: <span class="cm-string-2">`Not found Supplier with id ${</span><span class="cm-variable-2">req</span>.<span class="cm-property">params</span>.<span class="cm-property">id</span><span class="cm-string-2">}.`</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; });</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="cm-keyword">else</span> {</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable-2">res</span>.<span class="cm-property">render</span>(<span class="cm-string">"500"</span>, {<span class="cm-property">message</span>: <span class="cm-string-2">`Error retrieving Supplier with id ${</span><span class="cm-variable-2">req</span>.<span class="cm-property">params</span>.<span class="cm-property">id</span><span class="cm-string-2">}`</span>});</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; } <span class="cm-keyword">else</span> <span class="cm-variable-2">res</span>.<span class="cm-property">render</span>(<span class="cm-string">"supplier-update"</span>, {<span class="cm-property">supplier</span>: <span class="cm-variable-2">data</span>});</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; });</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> };</span></pre>
        </div>
        </div>
        </div>
        </div>
        </div>
        <div
            style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 572px;">
        </div>
        <div class="CodeMirror-gutters" style="display: none; height: 572px;"></div>
        </div>
        </div>
        </pre>
        <p>&nbsp;</p>
    </li>
    <li>
        <p><span>Edit the customer/app/models/</span><strong><span>supplier.model.js</span></strong><span> file. Delete
                the unnecessary functions in it so that what remains are only read-only functions.</span></p>
        <p><i class="fa-solid fa-circle-exclamation" aria-label="Important icon"></i><span>
            </span><strong><span>Important:</span></strong><span> </span><em><span>KEEP</span></em><span> the last line
                of the file: </span><code>module.exports = Supplier;</code></p>
        <p><i class="fa-solid fa-note-sticky" aria-label="Note icon"></i><span>
            </span><strong><span>Note:</span></strong><span> The model should still contain two functions:
                Supplier.getAll and Supplier.findById.</span></p>
    </li>
    <li>
        <p><span>Later in the project, when you deploy the microservices behind an Application Load Balancer, you will
                want </span><em><span>employees</span></em><span> to be able to navigate from the main
            </span><em><span>customer</span></em><span> page to the area of the web application where they can add,
                edit, or delete supplier entries. To support this, edit the
                customer/views/</span><strong><span>nav.html</span></strong><span> file:</span></p>
        <ul>
            <li>
                <p><span>On line 3, change </span><code>Monolithic Coffee suppliers</code><span> to
                    </span><code>Coffee suppliers</code></p>
            </li>
            <li>
                <p><span>On line 7, change </span><code>Home</code><span> to </span><code>Customer home</code></p>
            </li>
            <li>
                <p><span>Add a new line </span><em><span>after</span></em><span> line 8 that contains the following
                        HTML:</span></p>
                <p><i class="fa-solid fa-circle-exclamation" aria-label="Important icon"></i><span>
                    </span><strong><span>Important:</span></strong><span> </span><em><span>DON'T</span></em><span>
                        delete or overwrite any of the existing lines in the file.</span></p>
                <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false"
                    lang="html"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="html"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">a</span> <span class="cm-attribute">class</span>=<span class="cm-string">"nav-link"</span> <span class="cm-attribute">href</span>=<span class="cm-string">"/admin/suppliers"</span><span class="cm-tag cm-bracket">&gt;</span>Administrator link<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">a</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
                </div>
                </div>
                </div>
                </div>
                </div>
                </div>
                <div
                    style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;">
                </div>
                <div class="CodeMirror-gutters" style="display: none; height: 22px;"></div>
                </div>
                </div>
                </pre>
                <p><strong><span>Analysis:</span></strong><span> Adding this link will provide a navigation path to
                        those pages that will be hosted under the </span><code>/admin/</code><span> URL path.</span></p>
            </li>
        </ul>
    </li>
    <li>
        <p><span>You don't want customers to see the </span><strong><span>Add a new supplier</span></strong><span>
                button or any </span><strong><span>edit</span></strong><span> buttons next to supplier rows. To
                implement these changes, edit the
                customer/views/</span><strong><span>supplier-list-all.html</span></strong><span> file:</span></p>
        <ul>
            <li>
                <p><span>Remove line 32, which contains </span><code>Add a new supplier</code><span>. </span></p>
            </li>
            <li>
                <p><span>Remove lines 26 and 27, which contain </span><code>badge badge-info</code><span> and
                    </span><code>supplier-update</code><span>.</span></p>
            </li>
        </ul>
    </li>
    <li>
        <p><span>Because the customer microservice doesn't need to support read-write actions,
            </span><em><span>DELETE</span></em><span> the following .html files from the
                customer/</span><strong><span>views</span></strong><span> directory:</span></p>
        <ul>
            <li>
                <p><span>supplier-add.html</span></p>
            </li>
            <li>
                <p><span>supplier-form-fields.html</span></p>
            </li>
            <li>
                <p><span>supplier-update.html</span></p>
            </li>
        </ul>
    </li>
    <li>
        <p><span>Edit the customer/</span><strong><span>index.js</span></strong><span> file as needed to account for the
                fact that the node application will now run on Docker containers:</span></p>
        <ul>
            <li>
                <p><span>Comment out lines 27 to 37 (ensure that each line starts with
                    </span><code>//</code><span>).</span></p>
            </li>
            <li>
                <p><span>On line 45, change the port number to </span><code>8080</code></p>
                <p><i class="fa-solid fa-lightbulb" aria-label="Tip icon"></i><span>
                    </span><strong><span>Tip:</span></strong><span> Recall that when this application ran on the
                    </span><em><span>MonolithicAppServer</span></em><span> instance, it ran on port 80. However, when it
                        runs as a Docker container, you will want the container to run on port 8080.</span></p>
            </li>
        </ul>
        <p>&nbsp;</p>
    </li>
</ol>
<h3 id="a-idp4t3atask-43-create-the-customer-microservice-dockerfile-and-launch-a-test-container"><a
        id="p4t3"></a><span>Task 4.3: Create the </span><em><span>customer</span></em><span> microservice Dockerfile and
        launch a test container</span></h3>
<p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
<p><span>The following diagram provides an overview of how you will use </span><a href="https://aws.amazon.com/docker/"
        target="_blank" rel="noopener noreferrer"><span>Docker</span></a><span>. Assets that you will use or create are
        represented by rectangles. Commands that you will use are shown in blue between and above the rectangles.</span>
</p>
<p><img src="images/understanding-docker.png" referrerpolicy="no-referrer"
        alt="Diagram of Docker assets you will use or create, and commands you will use."></p>
<p><span>With the application code base and a Dockerfile, which you will create, you will build a
    </span><em><span>Docker image</span></em><span>. A Docker image is a template with instructions to create and run a
        Docker </span><em><span>container</span></em><span>. You can think of a Docker
    </span><em><span>image</span></em><span> as roughly equivalent to an Amazon Machine Image (AMI) from which you can
        launch an EC2 instance. A Docker </span><em><span>container</span></em><span> is roughly equivalent to an EC2
        instance. However, Docker images and containers are much smaller. </span></p>
<p>&nbsp;</p>
<ol start="">
    <li>
        <p><span>In the </span><strong><span>customer</span></strong><span> directory, create a new file named
            </span><code>Dockerfile</code><span> that contains the following code:</span></p>
        <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false"
            lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">FROM <span class="cm-builtin">node</span>:11-alpine</span></pre>
        </div>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">RUN <span class="cm-builtin">mkdir</span> <span class="cm-attribute">-p</span> /usr/src/app</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">WORKDIR /usr/src/app</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">COPY . .</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">RUN <span class="cm-builtin">npm</span> install</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">EXPOSE <span class="cm-number">8080</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">CMD [<span class="cm-string">"npm"</span>, <span class="cm-string">"run"</span>, <span class="cm-string">"start"</span>]</span></pre>
        </div>
        </div>
        </div>
        </div>
        </div>
        <div
            style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 154px;">
        </div>
        <div class="CodeMirror-gutters" style="display: none; height: 154px;"></div>
        </div>
        </div>
        </pre>
        <p><strong><span>Analysis:</span></strong><span> This Dockerfile code specifies that an Alpine Linux
                distribution with Node.js runtime requirements should be used to create a Docker image. The code also
                specifies that the container should allow network traffic on TCP port 8080 and that the application
                should be run and started when a container that was created from the image is launched.</span></p>
    </li>
    <li>
        <p><span>Build an image from the customer Dockerfile.</span></p>
        <ul>
            <li>
                <p><span>In the AWS Cloud9 terminal, change to the </span><strong><span>customer</span></strong><span>
                        directory.</span></p>
            </li>
            <li>
                <p><span>Run the following command:</span></p>
                <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false"
                    lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">docker build <span class="cm-attribute">--tag</span> customer .</span></pre>
                </div>
                </div>
                </div>
                </div>
                </div>
                </div>
                <div
                    style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;">
                </div>
                <div class="CodeMirror-gutters" style="display: none; height: 22px;"></div>
                </div>
                </div>
                </pre>
                <p><i class="fa-solid fa-note-sticky" aria-label="Note icon"></i><span>
                    </span><strong><span>Note:</span></strong><span> In the output, ignore the npm warning about no
                        repository field.</span></p>
                <p><span>Notice that the build downloaded the node Alpine starter image and then completed the other
                        instructions as specified in the Dockerfile.</span></p>
            </li>
        </ul>
    </li>
    <li>
        <p><span>Verify that the customer-labeled Docker image was created.</span></p>
        <ul>
            <li>
                <p><span>Run a Docker command to list the Docker images that your Docker client is aware of.</span></p>
                <p><i class="fa-solid fa-lightbulb" aria-label="Tip icon"></i><span>
                    </span><strong><span>Tip:</span></strong><span> To find the command that you need to run, see
                    </span><a href="https://docs.docker.com/engine/reference/commandline/cli/" target="_blank"
                        rel="noopener noreferrer"><span>Use the Docker Command Line</span></a><span> in the Docker
                        documentation.</span></p>
                <p><i class="fa-solid fa-lightbulb" aria-label="Tip icon"></i><span>
                    </span><strong><span>Tip:</span></strong><span> The output of the command should be similar to the
                        following:</span></p>
                <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false"
                    lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">REPOSITORY &nbsp; &nbsp; TAG &nbsp; &nbsp; &nbsp; &nbsp; IMAGE ID &nbsp; &nbsp; &nbsp; CREATED &nbsp; &nbsp; &nbsp; &nbsp;  SIZE</span></pre>
                </div>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;">customer &nbsp; &nbsp; &nbsp; latest &nbsp; &nbsp;  cdc593c9bf51 &nbsp; <span class="cm-number">59</span> seconds ago &nbsp; <span class="cm-number">82</span>.7MB</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">node</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">11</span><span class="cm-attribute">-alpine</span> &nbsp; f18da2f58c3d &nbsp; <span class="cm-number">3</span> years ago &nbsp; &nbsp; &nbsp;<span class="cm-number">75</span>.5MB</span></pre>
                </div>
                </div>
                </div>
                </div>
                </div>
                <div
                    style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 66px;">
                </div>
                <div class="CodeMirror-gutters" style="display: none; height: 66px;"></div>
                </div>
                </div>
                </pre>
                <p><i class="fa-solid fa-note-sticky" aria-label="Note icon"></i><span>
                    </span><strong><span>Note:</span></strong><span> The </span><em><span>node</span></em><span> image
                        is the Alpine Linux image that you identified in the Dockerfile contents to download and use as
                        the starter image. Your Docker client downloaded it from docker.io. The
                    </span><em><span>customer</span></em><span> image is the one that you created.</span></p>
            </li>
        </ul>
    </li>
    <li>
        <p><span>Launch a Docker </span><em><span>container</span></em><span> that runs the
            </span><em><span>customer</span></em><span> microservice on port 8080. As part of the command, pass an
                environment variable to tell the node application the correct location of the database.</span></p>
        <ul>
            <li>
                <p><span>To set a dbEndpoint variable in your terminal session, run the following commands:</span></p>
                <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false"
                    lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">dbEndpoint</span><span class="cm-operator">=</span><span class="cm-quote">$(cat ~/environment/microservices/customer/app/config/config.js | grep 'APP_DB_HOST' | cut -d '"' -f2)</span></span></pre>
                </div>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">echo</span> <span class="cm-def">$dbEndpoint</span></span></pre>
                </div>
                </div>
                </div>
                </div>
                </div>
                <div
                    style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 66px;">
                </div>
                <div class="CodeMirror-gutters" style="display: none; height: 66px;"></div>
                </div>
                </div>
                </pre>
                <p><i class="fa-solid fa-note-sticky" aria-label="Note icon"></i><span>
                    </span><strong><span>Note:</span></strong><span> You could manually find the database endpoint in
                        the Amazon RDS console and set it as an environment variable by running
                    </span><code>dbEndpoint="&lt;actual-db-endpoint&gt;"</code><span> instead of using the cat
                        command.</span></p>
                <p><i class="fa-solid fa-circle-exclamation" aria-label="Important icon"></i><span>
                    </span><strong><span>Important:</span></strong><span> If you close your AWS Cloud9 terminal or stop
                        and restart the project lab environment, and then need to run a command that uses the
                        $dbEndpoint variable, you might need to create the variable again. To test whether the variable
                        is set, run </span><code>echo $dbEndpoint</code></p>
            </li>
            <li>
                <p><span>The following code provides an example of the command you should run that launches a container
                        from the image:</span></p>
                <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false"
                    lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">docker run <span class="cm-attribute">-d</span> <span class="cm-attribute">--name</span> customer_1 <span class="cm-attribute">-p</span> <span class="cm-number">8080</span>:8080 <span class="cm-attribute">-e</span> <span class="cm-def">APP_DB_HOST</span><span class="cm-operator">=</span><span class="cm-string">"</span><span class="cm-def">$dbEndpoint</span><span class="cm-string">"</span> customer</span></pre>
                </div>
                </div>
                </div>
                </div>
                </div>
                </div>
                <div
                    style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;">
                </div>
                <div class="CodeMirror-gutters" style="display: none; height: 22px;"></div>
                </div>
                </div>
                </pre>
                <p><strong><span>Analysis:</span></strong><span> This command launched a container named
                    </span><em><span>customer_1</span></em><span> by using the
                    </span><em><span>customer</span></em><span> image that you created as the template. The
                    </span><code>-d</code><span> parameter in the command specified that it should run in the
                        background. After the </span><code>-p</code><span> parameter, the </span><em><span>first
                            number</span></em><span> specified the port on the AWS Cloud9 instance to publish the
                        container to. The </span><em><span>second number</span></em><span> indicated the port that the
                        container is running on in the </span><em><span>docker namespace</span></em><span> (also port
                        8080). The </span><code>-e</code><span> parameter passes the database host location as an
                        environment variable to Docker, which gives the node application the information that it needs
                        to establish network connectivity to the database.</span></p>
            </li>
        </ul>
    </li>
    <li>
        <p><span>Check which Docker containers are currently running on the AWS Cloud9 instance.</span></p>
        <p><i class="fa-solid fa-lightbulb" aria-label="Tip icon"></i><span>
            </span><strong><span>Tip:</span></strong><span> To find the command that you need to run, see </span><a
                href="https://docs.docker.com/engine/reference/commandline/cli/" target="_blank"
                rel="noopener noreferrer"><span>Use the Docker Command Line</span></a><span> in the Docker
                documentation.</span></p>
    </li>
    <li>
        <p><span>Verify that the </span><em><span>customer</span></em><span> microservice is running in the container
                and working as intended.</span></p>
        <ul>
            <li>
                <p><span>Load the following page in a new browser tab. Replace the IP address placeholder with the
                        public IPv4 address of the AWS Cloud9 instance that you are using:
                    </span><code>http://&lt;cloud-9-public-IPv4-address&gt;:8080</code></p>
                <p><span>The web application microservice should load in the browser.</span>
                    <!--testing note: may not work on VPN-->
                </p>
                <p><i class="fa-solid fa-circle-exclamation" aria-label="Important icon"></i><span>
                    </span><strong><span>Important:</span></strong><span> If you stop the lab environment and start it
                        again, the public IPv4 address of the AWS Cloud9 instance will change.</span></p>
            </li>
            <li>
                <p><span>Choose </span><strong><span>List of suppliers</span></strong><span>.</span></p>
            </li>
            <li>
                <p><span>Confirm that the supplier entries that you added earlier are displayed.</span></p>
                <p><i class="fa-solid fa-note-sticky" aria-label="Note icon"></i><span>
                    </span><strong><span>Note:</span></strong><span> Although you changed the location where the
                        application runs, it still connects to the same RDS database where the supplier records are
                        stored.</span></p>
                <p><i class="fa-solid fa-lightbulb" aria-label="Tip icon"></i><span>
                    </span><strong><span>Tip:</span></strong><span> The
                    </span><strong><span>Administrator</span></strong><span> link doesn't work because you haven't
                        created the employee microservice yet.</span></p>
            </li>
            <li>
                <p><span>Confirm that the suppliers page doesn't have </span><strong><span>Add a new
                            supplier</span></strong><span> and </span><strong><span>edit</span></strong><span>
                        buttons.</span></p>
                <p><i class="fa-solid fa-lightbulb" aria-label="Tip icon"></i><span>
                    </span><strong><span>Troubleshooting tip:</span></strong><span> If any functionality is missing,
                        follow these steps: (1) Stop and delete the running container, (2) modify the microservice
                        source code as appropriate, (3) create an updated Docker image from the source code, (4) launch
                        a new test container, and (5) verify whether the functionality is now available. For a list of
                        commands to run to accomplish these steps, see </span><a href="#app1" target="_self"
                        rel="noopener noreferrer"><span>Updating a test container running on Cloud9</span></a><span> in
                        the appendix of this file.</span></p>
            </li>
        </ul>
    </li>
    <li>
        <p><span>Commit and push your source code changes into CodeCommit.</span></p>
        <p><i class="fa-solid fa-lightbulb" aria-label="Tip icon"></i><span>
            </span><strong><span>Tip:</span></strong><span> You can use the </span><a
                href="https://docs.aws.amazon.com/cloud9/latest/user-guide/using-gitpanel.html" target="_blank"
                rel="noopener noreferrer"><span>Git source control panel</span></a><span> in the AWS Cloud9 IDE, or you
                can use the </span><code>git commit</code><span> and </span><code>git push</code><span> commands in the
                terminal.</span></p>
        <p><i class="fa-solid fa-note-sticky" aria-label="Note icon"></i><span>
            </span><strong><span>Note:</span></strong><span> If your educator has asked you to collect information about
                your solution, be sure to record the commands that you run in this step and the output that was
                returned.</span></p>
    </li>
    <li>
        <p><span>Optional: Observe the commit details in the CodeCommit console.</span></p>
        <p><span>In the </span><strong><span>Commits</span></strong><span> area of the repository, choose the ID for the
                most recent commit. Scroll down to see information about what changed in the files since the previous
                commit.</span></p>
        <p><span>Notice that deleted lines are shown in red, and added lines are shown in green so that you are able to
                see every detail of every change to every file that was modified.</span></p>
        <p>&nbsp;</p>
    </li>
</ol>
<h3 id="a-idp4t4atask-44-modify-the-source-code-of-the-employee-microservice"><a id="p4t4"></a><span>Task 4.4: Modify
        the source code of the </span><em><span>employee</span></em><span> microservice</span></h3>
<p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
<p><span>In this task, you will modify the source code for the </span><em><span>employee</span></em><span> microservice
        similarly to how you modified the code for the customer microservice. Customers (café franchise location
        managers) should have read-only access to the application data, but employees of the café corporate office
        should be able to add new entries or modify existing entries in the list of coffee suppliers.</span></p>
<p><span>As you will see later in this project, you will deploy the microservices behind an Application Load Balancer
        and route traffic to the microservices based on the path that is contained in the URL of the request. In this
        way, if the URL path includes </span><code>/admin/</code><span>, the load balancer will route the traffic to the
    </span><em><span>employee</span></em><span> microservice. Otherwise, if the URL path doesn't include
    </span><code>/admin/</code><span>, then the load balancer will route the traffic to the
    </span><em><span>customer</span></em><span> microservice.</span></p>
<p><span>Because of the need to route traffic, much of the work in this task is to configure the employee microservice
        to add </span><code>/admin/</code><span> to the path of the pages that it serves.</span></p>
<p>&nbsp;</p>
<ol start="">
    <li>
        <p><span>In the AWS Cloud9 IDE, return to the file view (toggletree view).</span></p>
    </li>
    <li>
        <p><em><span>Collapse</span></em><span> the </span><strong><span>customer</span></strong><span> directory, and
                then </span><em><span>expand</span></em><span> the </span><strong><span>employee</span></strong><span>
                directory.</span></p>
    </li>
    <li>
        <p><span>In the employee/app/controller/</span><strong><span>supplier.controller.js</span></strong><span> file,
                for all the redirect calls, prepend </span><code>/admin</code><span> to the path.</span></p>
        <p><i class="fa-solid fa-lightbulb" aria-label="Tip icon"></i><span>
            </span><strong><span>Tip:</span></strong><span> To find the three lines that need to be updated, run the
                following commands in the terminal:</span></p>
        <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false"
            lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">cd</span> ~/environment/microservices/employee</span></pre>
        </div>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">grep</span> <span class="cm-attribute">-n</span> <span class="cm-string">'redirect'</span> app/controller/supplier.controller.js</span></pre>
        </div>
        </div>
        </div>
        </div>
        </div>
        <div
            style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 44px;">
        </div>
        <div class="CodeMirror-gutters" style="display: none; height: 44px;"></div>
        </div>
        </div>
        </pre>
    </li>
</ol>
<ol start="4">
    <li>
        <p><span>In the employee/</span><strong><span>index.js</span></strong><span> file, update the
            </span><em><span>app.get</span></em><span> calls, </span><em><span>app.post</span></em><span> calls, and a
                port number.</span></p>
        <ul>
            <li>
                <p><span>For all </span><code>app.get</code><span> and </span><code>app.post</code><span> calls, prepend
                    </span><code>/admin</code><span> to the first parameter.</span></p>
                <p><i class="fa-solid fa-lightbulb" aria-label="Tip icon"></i><span>
                    </span><strong><span>Tip:</span></strong><span> To find the seven lines that need to be updated, run
                        the following command in the terminal:</span></p>
                <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false"
                    lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">grep</span> <span class="cm-attribute">-n</span> <span class="cm-string">'app.get\|app.post'</span> index.js</span></pre>
                </div>
                </div>
                </div>
                </div>
                </div>
                </div>
                <div
                    style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;">
                </div>
                <div class="CodeMirror-gutters" style="display: none; height: 22px;"></div>
                </div>
                </div>
                </pre>
                <p><i class="fa-solid fa-circle-exclamation" aria-label="Important icon"></i><span>
                    </span><strong><span>Important:</span></strong><span> After you edit line 22, the path should be
                    </span><code>/admin</code><span>, </span><em><span>not</span></em><span> </span><code>/admin/</code>
                </p>
            </li>
        </ul>
        <ul>
            <li>
                <p><span>On line 45, change the port number to </span><code>8081</code></p>
                <p><i class="fa-solid fa-note-sticky" aria-label="Note icon"></i><span>
                    </span><strong><span>Note:</span></strong><span> When you run both the customer and employee
                        microservice containers on the AWS Cloud9 instance as a test, they will need to use different
                        port numbers so that they won't conflict with each other.</span></p>
            </li>
        </ul>
    </li>
</ol>
<ol start="5">
    <li>
        <p><span>In the employee/views/</span><strong><span>supplier-add.html</span></strong><span> and
                employee/views/</span><strong><span>supplier-update.html</span></strong><span> files, for the form
                action paths, prepend </span><code>/admin</code><span> to the path.</span></p>
        <p><i class="fa-solid fa-lightbulb" aria-label="Tip icon"></i><span>
            </span><strong><span>Tip:</span></strong><span> To find the three lines that need to be updated in the two
                files, run the following command in the terminal:</span></p>
        <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false"
            lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">grep</span> <span class="cm-attribute">-n</span> <span class="cm-string">'action'</span> views/*</span></pre>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        <div
            style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;">
        </div>
        <div class="CodeMirror-gutters" style="display: none; height: 22px;"></div>
        </div>
        </div>
        </pre>
    </li>
</ol>
<ol start="6">
    <li>
        <p><span>In the employee/views/</span><strong><span>supplier-list-all.html</span></strong><span> and
                employee/views/</span><strong><span>home.html</span></strong><span> files, for the HTML paths, prepend
            </span><code>/admin</code><span> to the path.</span></p>
        <p><i class="fa-solid fa-lightbulb" aria-label="Tip icon"></i><span>
            </span><strong><span>Tip:</span></strong><span> To find the three lines that need to be updated in the two
                files, run the following command in the terminal:</span></p>
        <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false"
            lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">grep</span> <span class="cm-attribute">-n</span> <span class="cm-string">'href'</span> views/supplier-list-all.html views/home.html</span></pre>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        <div
            style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;">
        </div>
        <div class="CodeMirror-gutters" style="display: none; height: 22px;"></div>
        </div>
        </div>
        </pre>
    </li>
</ol>
<ol start="7">
    <li>
        <p><span>In the employee/views/</span><strong><span>header.html</span></strong><span> file, modify the title to
                be </span><code>Manage coffee suppliers</code></p>
    </li>
    <li>
        <p><span>Edit the employee/views/</span><strong><span>nav.html</span></strong><span> file.</span></p>
        <ul>
            <li>
                <p><span>On line 3, change </span><code>Monolithic Coffee suppliers</code><span> to
                    </span><code>Manage coffee suppliers</code></p>
            </li>
        </ul>
        <ul>
            <li>
                <p><span>On line 7, replace the existing line of code with the following:</span></p>
                <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false"
                    lang="html"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="html"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">a</span> <span class="cm-attribute">class</span>=<span class="cm-string">"nav-link"</span> <span class="cm-attribute">href</span>=<span class="cm-string">"/admin/suppliers"</span><span class="cm-tag cm-bracket">&gt;</span>Administrator home<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">a</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
                </div>
                </div>
                </div>
                </div>
                </div>
                </div>
                <div
                    style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;">
                </div>
                <div class="CodeMirror-gutters" style="display: none; height: 22px;"></div>
                </div>
                </div>
                </pre>
                <p><i class="fa-solid fa-note-sticky" aria-label="Note icon"></i><span>
                    </span><strong><span>Note:</span></strong><span> Both the href value and the name of the link are
                        modified in the new line.</span></p>
            </li>
        </ul>
        <ul>
            <li>
                <p><span>Add a new line </span><em><span>after</span></em><span> line 8 that contains the following
                        HTML:</span></p>
                <p><i class="fa-solid fa-circle-exclamation" aria-label="Important icon"></i><span>
                    </span><strong><span>Important:</span></strong><span> </span><em><span>DON'T</span></em><span>
                        delete or overwrite any of the existing lines in the file.</span></p>
                <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false"
                    lang="html"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="html"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">a</span> <span class="cm-attribute">class</span>=<span class="cm-string">"nav-link"</span> <span class="cm-attribute">href</span>=<span class="cm-string">"/"</span><span class="cm-tag cm-bracket">&gt;</span>Customer home<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">a</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
                </div>
                </div>
                </div>
                </div>
                </div>
                </div>
                <div
                    style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;">
                </div>
                <div class="CodeMirror-gutters" style="display: none; height: 22px;"></div>
                </div>
                </div>
                </pre>
                <p><strong><span>Analysis:</span></strong><span> Later in the project, when you deploy the microservices
                        behind an Application Load Balancer, you will want employees to be able to navigate from the
                        admin pages back to the customer area of the web application. Adding this link provides a
                        navigation path for employees to the pages that will be hosted by the
                    </span><em><span>customer</span></em><span> microservice under the </span><code>/</code><span> URL
                        path.</span></p>
            </li>
        </ul>
        <ul>
            <li>
                <p><span>Save the changes.</span></p>
                <p><span> </span></p>
            </li>
        </ul>
    </li>
</ol>
<h3 id="a-idp4t5atask-45-create-the-employee-microservice-dockerfile-and-launch-a-test-container"><a
        id="p4t5"></a><span>Task 4.5: Create the </span><em><span>employee</span></em><span> microservice Dockerfile and
        launch a test container</span></h3>
<p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
<p><span>In this task, you will create a Docker image for the </span><em><span>employee</span></em><span> microservice.
        Then, you will launch a test container from the image and verify that the microservice works as expected.</span>
</p>
<p>&nbsp;</p>
<ol start="">
    <li>
        <p><span>Create a Dockerfile for the </span><em><span>employee</span></em><span> microservice.</span></p>
        <ul>
            <li>
                <p><span>Duplicate the Dockerfile from the customer microservice into the employee microservice
                        area.</span></p>
            </li>
            <li>
                <p><span>Edit the employee/</span><strong><span>Dockerfile</span></strong><span> to change the port
                        number on the </span><code>EXPOSE</code><span> line to </span><code>8081</code></p>
            </li>
        </ul>
    </li>
</ol>
<ol start="2">
    <li>
        <p><span>Build the Docker image for the </span><em><span>employee</span></em><span> microservice. Specify
            </span><code>employee</code><span> as the tag.</span></p>
    </li>
    <li>
        <p><span>Run a container named </span><code>employee_1</code><span> based on the employee image. Run it on port
                8081 and be sure to pass in the database endpoint.</span></p>
    </li>
    <li>
        <p><span>Verify that the employee microservice is running in the container and that the microservice functions
                as intended.</span></p>
        <ul>
            <li>
                <p><span>Load the microservice web page in a new browser tab at
                    </span><code>http://&lt;cloud9-public-ip-address&gt;:8081/admin/suppliers</code></p>
                <p><span>The application should load.</span></p>
            </li>
            <li>
                <p><span>Verify that this view shows buttons to edit existing suppliers and to add a new
                        supplier.</span></p>
                <p><i class="fa-solid fa-note-sticky" aria-label="Note icon"></i><span>
                    </span><strong><span>Note:</span></strong><span> Links that should take you to the
                    </span><em><span>customer</span></em><span> microservice will not work. For example, if you choose
                    </span><strong><span>Customer home</span></strong><span> or </span><strong><span>Suppliers
                            list</span></strong><span>, the pages won't be found because the link assumes that the
                    </span><em><span>customer</span></em><span> microservice also runs on port 8081 (but it doesn't).
                        You can ignore this issue—these links should work as intended when you deploy the microservices
                        to Amazon ECS later.</span></p>
            </li>
            <li>
                <p><span>Test adding a new supplier.</span></p>
                <p><span>Verify that the new supplier appears on the suppliers page.</span></p>
            </li>
            <li>
                <p><span>Test editing an existing supplier.</span></p>
                <p><span>Verify that the edited supplier information appears on the suppliers page.</span></p>
            </li>
            <li>
                <p><span>Test deleting an existing supplier:</span></p>
                <ul>
                    <li>
                        <p><span>On the row for a particular supplier entry, choose
                            </span><strong><span>edit</span></strong><span>.</span></p>
                    </li>
                    <li>
                        <p><span>At the bottom of the page, choose </span><strong><span>Delete this
                                    supplier</span></strong><span>, and then choose </span><strong><span>Delete this
                                    supplier</span></strong><span> again.</span></p>
                        <p><span>Verify that the supplier no longer appears on the suppliers page.</span></p>
                        <p><i class="fa-solid fa-lightbulb" aria-label="Tip icon"></i><span>
                            </span><strong><span>Troubleshooting tip:</span></strong><span> If any of the functionality
                                mentioned above isn't working as intended, follow these steps: (1) Stop and delete the
                                running container, (2) modify the microservice source code as appropriate, (3) create an
                                updated Docker image from the source code, (4) launch a new test container, and (5)
                                verify whether the functionality is now available. For a list of commands to run to
                                accomplish these steps, see </span><a href="#app1" target="_self"
                                rel="noopener noreferrer"><span>Updating a test container running on
                                    Cloud9</span></a><span> in the appendix of this file.</span></p>
                    </li>
                </ul>
            </li>
        </ul>
    </li>
</ol>
<ol start="5">
    <li>
        <p><span>To observe details about both running test containers, run the following command:</span></p>
        <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false"
            lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">docker <span class="cm-builtin">ps</span></span></pre>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        <div
            style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;">
        </div>
        <div class="CodeMirror-gutters" style="display: none; height: 22px;"></div>
        </div>
        </div>
        </pre>
        <p>&nbsp;</p>
    </li>
</ol>
<h3 id="a-idp4t6atask-46-adjust-the-employee-microservice-port-and-rebuild-the-image"><a id="p4t6"></a><span>Task 4.6:
        Adjust the </span><em><span>employee</span></em><span> microservice port and rebuild the image</span></h3>
<p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
<p><span>When you tested the employee microservice on the AWS Cloud9 instance, you ran it on port 8081. However, when
        you deploy it to Amazon ECS, you will want it to run on port 8080. To adjust this, you need to modify two
        files.</span></p>
<p>&nbsp;</p>
<ol start="">
    <li>
        <p><span>Edit the employee/</span><strong><span>index.js</span></strong><span> and
                employee/</span><strong><span>Dockerfile</span></strong><span> files to change the port from
            </span><code>8081</code><span> to </span><code>8080</code></p>
    </li>
    <li>
        <p><span>Rebuild the Docker image for the employee microservice.</span></p>
        <ul>
            <li>
                <p><span>To stop and delete the existing container (assumes that the container name is
                    </span><em><span>employee_</span></em><span>), run the following command:</span></p>
                <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false"
                    lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">docker <span class="cm-builtin">rm</span> <span class="cm-attribute">-f</span> employee_1 </span></pre>
                </div>
                </div>
                </div>
                </div>
                </div>
                </div>
                <div
                    style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;">
                </div>
                <div class="CodeMirror-gutters" style="display: none; height: 22px;"></div>
                </div>
                </div>
                </pre>
            </li>
        </ul>
        <ul>
            <li>
                <p><span>Ensure that your terminal is in the </span><strong><span>employee</span></strong><span>
                        directory.</span></p>
            </li>
            <li>
                <p><span>Use the </span><code>docker build</code><span> command to build a new image from the latest
                        source files that you edited. Use the employee tag.</span></p>
                <p><i class="fa-solid fa-lightbulb" aria-label="Tip icon"></i><span>
                    </span><strong><span>Tip:</span></strong><span> If you build an image with the name of an existing
                        image, the existing image will be overwritten.</span></p>
                <p><i class="fa-solid fa-note-sticky" aria-label="Note icon"></i><span>
                    </span><strong><span>Note:</span></strong><span> You don't need to run a new test container, so you
                        don't need to run </span><code>docker run</code><span>.</span></p>
            </li>
        </ul>
    </li>
</ol>
<h3 id="a-idp4t7atask-47-check-code-into-codecommit"><a id="p4t7"></a><span>Task 4.7: Check code into CodeCommit</span>
</h3>
<p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
<p><span>In this task, you will commit and push the changes that you made to the employee microservice to
        CodeCommit.</span></p>
<ol start="">
    <li>
        <p><span>Review the updates that you made to the source code. To accomplish this:</span></p>
        <ul>
            <li>
                <p><span>Choose the source control icon in the AWS Cloud9 IDE.</span></p>
                <p><span>Notice the changes list, which indicates which files were changed since you last checked files
                        in to the remote Git repository (CodeCommit).</span></p>
            </li>
        </ul>
        <ul>
            <li>
                <p><span>Choose one of the files that was modified, such as index.js, to compare the version from the
                        last Git commit to the latest version. Changes are highlighted.</span></p>
                <p><span>This demonstrates a benefit of using a source control system and a Git-compatible IDE such as
                        AWS Cloud9. You can review your code changes prior to committing.</span></p>
            </li>
        </ul>
    </li>
    <li>
        <p><span>Check your changes into CodeCommit.</span></p>
        <p><i class="fa-solid fa-lightbulb" aria-label="Tip icon"></i><span>
            </span><strong><span>Tip:</span></strong><span> You performed this same type of action in task 4.3. You can
                accomplish this step by using the Git source control panel, or you can use the
            </span><code>git commit</code><span> and </span><code>git push</code><span> commands in the terminal.</span>
        </p>
        <p>&nbsp;</p>
    </li>
</ol>
<h2 id="a-idp5aphase-5-creating-ecr-repositories-an-ecs-cluster-task-definitions-and-appspec-files"><a
        id="p5"></a><span>Phase 5: Creating ECR repositories, an ECS cluster, task definitions, and AppSpec files</span>
</h2>
<p><span>At this point, you have successfully implemented numerous solution requirements. You split the monolithic
        application into two microservices that can run as Docker containers. You have also verified that the containers
        support the needed application actions, such as adding, editing, and deleting entries from the database. The
        microservices architecture still uses Amazon RDS to store the coffee supplier entries.</span></p>
<p><span>However, your work isn't finished. There are more solution requirements to implement. The containers are able
        to run on the AWS Cloud9 instance, but that isn't a scalable deployment architecture. You need the ability to
        scale the number of containers that run on each microservice up and down depending on need. Also, you need to
        have a load balancer to route traffic to the appropriate microservice. Finally, you need to be able to easily
        update each application microservice's codebase independently and roll those changes into production. In the
        remaining phases of the project, you will work to accomplish these solution requirements.</span></p>
<h3 id="a-idp5t1atask-51-create-ecr-repositories-and-upload-the-docker-images"><a id="p5t1"></a><span>Task 5.1: Create
        ECR repositories and upload the Docker images</span></h3>
<p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
<p><span>In this phase, you will upload the latest Docker images of the two microservices to separate Amazon ECR
        repositories.</span></p>
<p>&nbsp;</p>
<ol start="">
    <li>
        <p><span>To authorize your Docker client to connect to the Amazon ECR service, run the following
                commands:</span></p>
        <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false"
            lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">account_id</span><span class="cm-operator">=</span><span class="cm-quote">$(aws sts get-caller-identity |grep Account|cut -d '"' -f4)</span></span></pre>
        </div>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">echo</span> <span class="cm-def">$account_id</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">aws ecr get-login-password <span class="cm-attribute">--region</span> us-east-1 | docker login <span class="cm-attribute">--username</span> AWS <span class="cm-attribute">--password-stdin</span> <span class="cm-def">$account_id</span>.dkr.ecr.us-east-1.amazonaws.com</span></pre>
        </div>
        </div>
        </div>
        </div>
        </div>
        <div
            style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 88px;">
        </div>
        <div class="CodeMirror-gutters" style="display: none; height: 88px;"></div>
        </div>
        </div>
        </pre>
        <p><span>A message in the command output indicates that the login succeeded.</span></p>
    </li>
    <li>
        <p><span>Create a separate private ECR repository for each microservice.</span></p>
        <ul>
            <li>
                <p><span>Name the first repository </span><code>customer</code></p>
            </li>
            <li>
                <p><span>Name the second repository </span><code>employee</code></p>
            </li>
        </ul>
    </li>
</ol>
<ol start="3">
    <li>
        <p><span>Set permissions on the </span><em><span>customer</span></em><span> ECR repository.</span></p>
        <ul>
            <li>
                <p><span>For information about editing the existing JSON policy, see </span><a
                        href="https://docs.aws.amazon.com/AmazonECR/latest/userguide/set-repository-policy.html"
                        target="_blank" rel="noopener noreferrer"><span>Setting a Private Repository
                            Statement</span></a><span> in the Amazon ECR User Guide.</span></p>
            </li>
        </ul>
        <ul>
            <li>
                <p><span>Replace the existing lines in the policy with the following:</span></p>
                <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false"
                    lang="json"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="json"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre>
                </div>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string cm-property">"Version"</span>: <span class="cm-string">"2008-10-17"</span>,</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string cm-property">"Statement"</span>: [</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"Effect"</span>: <span class="cm-string">"Allow"</span>,</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"Principal"</span>: <span class="cm-string">"*"</span>,</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"Action"</span>: <span class="cm-string">"ecr:*"</span></span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; ]</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre>
                </div>
                </div>
                </div>
                </div>
                </div>
                <div
                    style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 220px;">
                </div>
                <div class="CodeMirror-gutters" style="display: none; height: 220px;"></div>
                </div>
                </div>
                </pre>
            </li>
        </ul>
    </li>
</ol>
<ol start="4">
    <li>
        <p><span>Use the same approach to set the same permissions on the </span><em><span>employee</span></em><span>
                ECR repository.</span></p>
    </li>
    <li>
        <p><span>Tag the Docker images with your unique </span><em><span>registryId</span></em><span> (account ID) value
                to make it easier to manage and keep track of these images.</span></p>
        <ul>
            <li>
                <p><span>In the AWS Cloud9 IDE, run the following commands:</span></p>
                <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false"
                    lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">account_id</span><span class="cm-operator">=</span><span class="cm-quote">$(aws sts get-caller-identity |grep Account|cut -d '"' -f4)</span></span></pre>
                </div>
                <pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
    </span></span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Verify that the account_id value is assigned to the $account_id variable</span></span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">echo</span> <span class="cm-def">$account_id</span></span></pre>
                <pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
    </span></span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Tag the customer image</span></span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;">docker tag customer:latest <span class="cm-def">$account_id</span>.dkr.ecr.us-east-1.amazonaws.com/customer:latest</span></pre>
                <pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
    </span></span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Tag the employee image</span></span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;">docker tag employee:latest <span class="cm-def">$account_id</span>.dkr.ecr.us-east-1.amazonaws.com/employee:latest</span></pre>
                </div>
                </div>
                </div>
                </div>
                </div>
                <div
                    style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 264px;">
                </div>
                <div class="CodeMirror-gutters" style="display: none; height: 264px;"></div>
                </div>
                </div>
                </pre>
                <p><i class="fa-solid fa-note-sticky" aria-label="Note icon"></i><span>
                    </span><strong><span>Note:</span></strong><span> The commands don't return output.</span></p>
            </li>
            <li>
                <p><span>Run the appropriate </span><code>docker</code><span> command to verify that the images exist
                        and the tags were applied.</span></p>
                <p><i class="fa-solid fa-lightbulb" aria-label="Tip icon"></i><span>
                    </span><strong><span>Tip:</span></strong><span> To find the command that you need to run, see
                    </span><a href="https://docs.docker.com/engine/reference/commandline/cli/" target="_blank"
                        rel="noopener noreferrer"><span>Use the Docker Command Line</span></a><span> in the Docker
                        documentation.</span></p>
                <p><i class="fa-solid fa-lightbulb" aria-label="Tip icon"></i><span>
                    </span><strong><span>Tip:</span></strong><span> The output of the command should be similar to the
                        following image. Notice that the </span><em><span>latest</span></em><span> tag was applied and
                        that the image names now include the remote repository name where you intend to store it:</span>
                </p>
                <p><img src="images/ecr.png" referrerpolicy="no-referrer"
                        alt="Example output of docker images command."></p>
            </li>
        </ul>
    </li>
    <li>
        <p><span>Run the appropriate </span><code>docker</code><span> command to push each of the Docker images to
                Amazon ECR.</span></p>
        <p><i class="fa-solid fa-lightbulb" aria-label="Tip icon"></i><span>
            </span><strong><span>Tip:</span></strong><span> To find the command that you need to run, see </span><a
                href="https://docs.docker.com/engine/reference/commandline/cli/" target="_blank"
                rel="noopener noreferrer"><span>Use the Docker Command Line</span></a><span> in the Docker
                documentation.</span></p>
        <p><i class="fa-solid fa-lightbulb" aria-label="Tip icon"></i><span>
            </span><strong><span>Tip:</span></strong><span> Before running the Docker commands, run the following
                command to set </span><code>account_id</code><span> as a variable in the terminal. Then, when you run
                the Docker commands, you can reference the account ID as </span><code>$account_id</code><span>. </span>
        </p>
        <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false"
            lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">account_id</span><span class="cm-operator">=</span><span class="cm-quote">$(aws sts get-caller-identity |grep Account|cut -d '"' -f4)</span></span></pre>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        <div
            style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;">
        </div>
        <div class="CodeMirror-gutters" style="display: none; height: 22px;"></div>
        </div>
        </div>
        </pre>
        <p><i class="fa-solid fa-lightbulb" aria-label="Tip icon"></i><span> </span><strong><span>Additional
                    tip:</span></strong><span> The commands that you run should look like the following commands but
                with </span><strong><span>REPLACE_ME</span></strong><span> replaced with the correct command:</span></p>
        <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false"
            lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">docker REPLACE_ME <span class="cm-def">$account_id</span>.dkr.ecr.us-east-1.amazonaws.com/customer:latest</span></pre>
        </div>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">docker REPLACE_ME <span class="cm-def">$account_id</span>.dkr.ecr.us-east-1.amazonaws.com/employee:latest</span></pre>
        </div>
        </div>
        </div>
        </div>
        </div>
        <div
            style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 44px;">
        </div>
        <div class="CodeMirror-gutters" style="display: none; height: 44px;"></div>
        </div>
        </div>
        </pre>
        <p><span>The output for </span><em><span>each</span></em><span> Docker command that you run to push each image
                to Amazon ECR should look similar to the following:</span></p>
        <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false"
            lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">The push refers to repository [642015801240.dkr.ecr.us-east-1.amazonaws.com/node-app]</span></pre>
        </div>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">006e0ec54dba: Pushed</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">59762f95cb06: Pushed</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">22736f780b31: Pushed</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">d81d715330b7: Pushed</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">1dc7f3bb09a4: Pushed</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">dcaceb729824: Pushed</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">f1b5933fe4b5: Pushed</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">latest: digest: sha256:f75b60adddb8d6343b9dff690533a1cd1fbb34ccce6f861e84c857ba7a27b77d size: <span class="cm-number">1783</span></span></pre>
        </div>
        </div>
        </div>
        </div>
        </div>
        <div
            style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 220px;">
        </div>
        <div class="CodeMirror-gutters" style="display: none; height: 220px;"></div>
        </div>
        </div>
        </pre>
    </li>
    <li>
        <p><span>Confirm that the two images are now stored in Amazon ECR and that each has the
            </span><em><span>latest</span></em><span> label applied.</span></p>
        <p>&nbsp;</p>
    </li>
</ol>
<h3 id="a-idp5t2atask-52-create-an-ecs-cluster"><a id="p5t2"></a><span>Task 5.2: Create an ECS cluster</span></h3>
<p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
<p><span>In this task, you will create an Amazon ECS cluster.</span></p>
<p>&nbsp;</p>
<ol start="">
    <li>
        <p><span>Create a serverless AWS Fargate cluster that is named
            </span><code>microservices-serverlesscluster</code></p>
        <p><span>Ensure that it's configured to use </span><em><span>LabVPC</span></em><span>,
            </span><em><span>PublicSubnet1</span></em><span>, and </span><em><span>PublicSubnet2</span></em><span>
                (remove any other subnets). </span><em><span>DON'T</span></em><span> select Amazon EC2 instances or ECS
                Anywhere.</span></p>
        <p><i class="fa-solid fa-circle-exclamation" aria-label="Important icon"></i><span>
            </span><strong><span>Important:</span></strong><span> After choosing the button to create the cluster, in
                the banner that appears across the top of the page, choose </span><strong><span>View in
                    CloudFormation</span></strong><span>. Wait until the stack that creates the cluster attains the
                status </span><em><span>CREATE_COMPLETE</span></em><span> before you proceed to the next task.
            </span><em><span>If the stack fails to create for any reason and therefore rolls back</span></em><span>,
                repeat these steps to try again. It should succeed the second time.</span></p>
        <p>&nbsp;</p>
    </li>
</ol>
<h3 id="a-idp5t3atask-53-create-a-codecommit-repository-to-store-deployment-files"><a id="p5t3"></a><span>Task 5.3:
        Create a CodeCommit repository to store deployment files</span></h3>
<p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
<p><span>In this task, you will create another CodeCommit repository. This repository will store the task configuration
        specification files that Amazon ECS will use for each microservice. The repository will also store AppSpec
        specification files that CodeDeploy will use for each microservice.</span></p>
<p>&nbsp;</p>
<ol start="">
    <li>
        <p><span>Create a new CodeCommit repository that is named </span><code>deployment</code><span> to store
                deployment configuration files.</span></p>
    </li>
    <li>
        <p><span>In AWS Cloud9, in the </span><strong><span>environment</span></strong><span> directory, create a new
                directory that is named </span><code>deployment</code><span>. Initialize the directory as a Git
                repository with a branch named </span><code>dev</code><span>.</span></p>
        <p>&nbsp;</p>
    </li>
</ol>
<h3 id="a-idp5t4atask-54-create-task-definition-files-for-each-microservice-and-register-them-with-amazon-ecs"><a
        id="p5t4"></a><span>Task 5.4: Create task definition files for each microservice and register them with Amazon
        ECS</span></h3>
<p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
<p><span>In this task, you will create a task definition file for each microservice and then register the task
        definitions with Amazon ECS.</span></p>
<p>&nbsp;</p>
<ol start="">
    <li>
        <p><span>In the new </span><strong><span>deployment</span></strong><span> directory, create an empty file named
            </span><code>taskdef-customer.json</code><span> </span></p>
    </li>
    <li>
        <p><span>Edit the </span><strong><span>taskdef-customer.json</span></strong><span> file.</span></p>
        <ul>
            <li>
                <p><span>Paste the following JSON code into the file:</span></p>
                <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="json"
                    style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="json"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre>
                </div>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"containerDefinitions"</span>: [</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"name"</span>: <span class="cm-string">"customer"</span>,</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"image"</span>: <span class="cm-string">"customer"</span>,</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"environment"</span>: [</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"name"</span>: <span class="cm-string">"APP_DB_HOST"</span>,</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"value"</span>: <span class="cm-string">"&lt;RDS-ENDPOINT&gt;"</span></span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ],</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"essential"</span>: <span class="cm-atom">true</span>,</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"portMappings"</span>: [</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"hostPort"</span>: <span class="cm-number">8080</span>,</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"protocol"</span>: <span class="cm-string">"tcp"</span>,</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"containerPort"</span>: <span class="cm-number">8080</span></span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ],</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"logConfiguration"</span>: {</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"logDriver"</span>: <span class="cm-string">"awslogs"</span>,</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"options"</span>: {</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"awslogs-create-group"</span>: <span class="cm-string">"true"</span>,</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"awslogs-group"</span>: <span class="cm-string">"awslogs-capstone"</span>,</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"awslogs-region"</span>: <span class="cm-string">"us-east-1"</span>,</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"awslogs-stream-prefix"</span>: <span class="cm-string">"awslogs-capstone"</span></span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ],</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"requiresCompatibilities"</span>: [</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"FARGATE"</span></span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ],</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"networkMode"</span>: <span class="cm-string">"awsvpc"</span>,</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"cpu"</span>: <span class="cm-string">"512"</span>,</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"memory"</span>: <span class="cm-string">"1024"</span>,</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"executionRoleArn"</span>: <span class="cm-string">"arn:aws:iam::&lt;ACCOUNT-ID&gt;:role/PipelineRole"</span>,</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"family"</span>: <span class="cm-string">"customer-microservice"</span></span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre>
                </div>
                </div>
                </div>
                </div>
                </div>
                <div
                    style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 858px;">
                </div>
                <div class="CodeMirror-gutters" style="display: none; height: 858px;"></div>
                </div>
                </div>
                </pre>
            </li>
            <li>
                <p><span>Replace a couple values in the file:</span></p>
                <ul>
                    <li>
                        <p><span>On line 37, replace </span><code>&lt;ACCOUNT-ID&gt;</code><span> with the actual
                                account ID.</span></p>
                    </li>
                    <li>
                        <p><span>On line 9, replace </span><code>&lt;RDS-ENDPOINT&gt;</code><span> with the actual RDS
                                endpoint.</span></p>
                    </li>
                </ul>
            </li>
            <li>
                <p><span>Save the changes.</span></p>
            </li>
        </ul>
    </li>
    <li>
        <p><span>To register the </span><em><span>customer</span></em><span> microservice task definition in Amazon ECS,
                run the following command:</span></p>
        <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false"
            lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">aws ecs register-task-definition <span class="cm-attribute">--cli-input-json</span> <span class="cm-string">"file:///home/ec2-user/environment/deployment/taskdef-customer.json"</span></span></pre>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        <div
            style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 44px;">
        </div>
        <div class="CodeMirror-gutters" style="display: none; height: 44px;"></div>
        </div>
        </div>
        </pre>
    </li>
    <li>
        <p><span>In the Amazon ECS console, verify that the </span><em><span>customer-microservice</span></em><span>
                task definition now appears in the </span><strong><span>Task definitions</span></strong><span> pane.
                Also, notice that the revision number displays after the task definition name.</span></p>
        <p><i class="fa-solid fa-lightbulb" aria-label="Tip icon"></i><span>
            </span><strong><span>Tip:</span></strong><span> Consult the </span><a
                href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task_definitions.html" target="_blank"
                rel="noopener noreferrer"><span>ECS documentation</span></a><span> if it is helpful.</span></p>
    </li>
    <li>
        <p><span>In the </span><em><span>deployment</span></em><span> directory, create a
            </span><code>taskdef-employee.json</code><span> specification file. </span></p>
        <ul>
            <li>
                <p><span>Add the same JSON code to it that currently exists in the
                    </span><em><span>taskdef-customer.json</span></em><span> file (where you have already set the
                        account ID and RDS endpoints).</span></p>
            </li>
            <li>
                <p><span>After you paste in the code, change the three occurrences of </span><code>customer</code><span>
                        to </span><code>employee</code></p>
            </li>
        </ul>
    </li>
    <li>
        <p><span>To register the </span><em><span>employee</span></em><span> task definition with Amazon ECS, run an AWS
                CLI command.</span></p>
    </li>
    <li>
        <p><span>In the Amazon ECS console, verify that the </span><em><span>employee-microservice</span></em><span>
                task definition now appears in the </span><strong><span>Task definitions</span></strong><span> pane.
                Also, notice that the revision number displays after the task definition name.</span></p>
        <p>&nbsp;</p>
    </li>
</ol>
<h3 id="a-idp5t5atask-55-create-appspec-files-for-codedeploy-for-each-microservice"><a id="p5t5"></a><span>Task 5.5:
        Create AppSpec files for CodeDeploy for each microservice</span></h3>
<p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
<p><span>In this task, you will continue to complete tasks to support deploying the microservices-based web application
        to run on an ECS cluster where the deployment is supported by a CI/CD pipeline. In this specific task, you will
        create two </span><a href="https://docs.aws.amazon.com/codedeploy/latest/userguide/reference-appspec-file.html"
        target="_blank" rel="noopener noreferrer"><span>application specification (AppSpec) files</span></a><span>, one
        for each microservice. These files will provide instructions for CodeDeploy to deploy the microservices to the
        Amazon ECS on Fargate infrastructure.</span></p>
<p>&nbsp;</p>
<ol start="">
    <li>
        <p><span>Create an AppSpec file for the </span><em><span>customer</span></em><span> microservice.</span></p>
        <ul>
            <li>
                <p><span>In the </span><em><span>deployment</span></em><span> directory, create a new file named
                    </span><code>appspec-customer.yaml</code></p>
            </li>
            <li>
                <p><span>Paste the following YAML code into the file:</span></p>
                <p><i class="fa-solid fa-circle-exclamation" aria-label="Important icon"></i><span>
                    </span><strong><span>Important:</span></strong><span> </span><em><span>DON'T</span></em><span>
                        modify </span><code>&lt;TASK_DEFINITION&gt;</code><span>. This setting will be updated
                        automatically when the pipeline runs.</span></p>
                <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false"
                    lang="yaml"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="yaml"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">version</span><span class="cm-meta">: </span><span class="cm-number">0.0</span></span></pre>
                </div>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">Resources</span><span class="cm-meta">:</span></span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">  - </span><span class="cm-atom">TargetService</span><span class="cm-meta">:</span></span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom"> &nbsp; &nbsp;  Type</span><span class="cm-meta">: </span>AWS<span class="cm-meta">::</span>ECS<span class="cm-meta">::</span>Service</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom"> &nbsp; &nbsp;  Properties</span><span class="cm-meta">:</span></span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom"> &nbsp; &nbsp; &nbsp;  TaskDefinition</span><span class="cm-meta">: </span>&lt;TASK_DEFINITION&gt;</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom"> &nbsp; &nbsp; &nbsp;  LoadBalancerInfo</span><span class="cm-meta">:</span></span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom"> &nbsp; &nbsp; &nbsp; &nbsp;  ContainerName</span><span class="cm-meta">: </span><span class="cm-string">"customer"</span></span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom"> &nbsp; &nbsp; &nbsp; &nbsp;  ContainerPort</span><span class="cm-meta">: </span><span class="cm-number">8080</span></span></pre>
                </div>
                </div>
                </div>
                </div>
                </div>
                <div
                    style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 198px;">
                </div>
                <div class="CodeMirror-gutters" style="display: none; height: 198px;"></div>
                </div>
                </div>
                </pre>
                <p><span> </span><i class="fa-solid fa-note-sticky" aria-label="Note icon"></i><span>
                    </span><strong><span>Note:</span></strong><span> This file is in YAML format. In YAML, indentation
                        is important. Verify that the code in your file maintains the indentation levels as shown in the
                        previous code block.</span></p>
            </li>
        </ul>
        <ul>
            <li>
                <p><span>Save the changes.</span></p>
            </li>
        </ul>
    </li>
</ol>
<p>&nbsp;</p>
<ol start="2">
    <li>
        <p><span>In the same directory, create an AppSpec file for the </span><em><span>employee</span></em><span>
                microservice.</span></p>
        <ul>
            <li>
                <p><span>Name the file </span><code>appspec-employee.yaml</code><span>.</span></p>
            </li>
            <li>
                <p><span>The contents of the file should be the same as the
                    </span><em><span>appspec-customer.yaml</span></em><span> file. However, change
                    </span><code>customer`` on the</code><span>containerName</span><code>line to be</code><span>employee`</span>
                </p>
            </li>
        </ul>
        <p>&nbsp;</p>
    </li>
</ol>
<h3 id="a-idp5t6atask-56-update-files-and-check-them-into-codecommit"><a id="p5t6"></a><span>Task 5.6: Update files and
        check them into CodeCommit</span></h3>
<p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
<p><span>In this task, you will update the two task definition files. Then, you will push the four files that you
        created in the last two tasks into the </span><em><span>deployment</span></em><span> repository.</span></p>
<p>&nbsp;</p>
<ol start="">
    <li>
        <p><span>Edit the </span><strong><span>taskdef-customer.json</span></strong><span> file.</span></p>
        <ul>
            <li>
                <p><span>Modify line 5 to match the following line:</span></p>
                <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false"
                    lang="json"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="json"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"image"</span>: <span class="cm-string">"&lt;IMAGE1_NAME&gt;"</span>,</span></pre>
                </div>
                </div>
                </div>
                </div>
                </div>
                </div>
                <div
                    style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;">
                </div>
                <div class="CodeMirror-gutters" style="display: none; height: 22px;"></div>
                </div>
                </div>
                </pre>
            </li>
        </ul>
        <ul>
            <li>
                <p><span>Save the change.</span></p>
                <p><strong><span>Analysis:</span></strong><span> </span><code>&lt;IMAGE1_NAME&gt;</code><span> is not a
                        valid image name, which is why you originally set the image name to
                    </span><em><span>customer</span></em><span> before running the AWS CLI command to register the first
                        revision of the file with Amazon ECS. However, at this point in the project, it's important to
                        set the image value to a placeholder text value. Later in this project, when you configure a
                        pipeline, you will identify </span><code>IMAGE1_NAME</code><span> as placeholder text that can
                        be dynamically updated. In summary, CodePipeline will set the correct image name dynamically at
                        runtime.</span></p>
            </li>
        </ul>
    </li>
    <li>
        <p><span>Edit the </span><strong><span>taskdef-employee.json</span></strong><span> file.</span></p>
        <ul>
            <li>
                <p><span>Modify line 5 to match the following line:</span></p>
                <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false"
                    lang="json"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="json"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"image"</span>: <span class="cm-string">"&lt;IMAGE1_NAME&gt;"</span>,</span></pre>
                </div>
                </div>
                </div>
                </div>
                </div>
                </div>
                <div
                    style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;">
                </div>
                <div class="CodeMirror-gutters" style="display: none; height: 22px;"></div>
                </div>
                </div>
                </pre>
            </li>
            <li>
                <p><span>Save the change.</span></p>
            </li>
        </ul>
    </li>
    <li>
        <p><span>Push all four files to CodeCommit.</span></p>
        <p><i class="fa-solid fa-note-sticky" aria-label="Note icon"></i><span>
            </span><strong><span>Note:</span></strong><span> Pushing the latest files to CodeCommit is essential. Later,
                when you create the CI/CD pipeline, the pipeline will pull these files from CodeCommit and use the
                details in them as instructions to deploy updates for your microservices to the Amazon ECS
                cluster.</span></p>
        <p>&nbsp;</p>
    </li>
</ol>
<h2 id="a-idp6aphase-6-creating-target-groups-and-an-application-load-balancer"><a id="p6"></a><span>Phase 6: Creating
        target groups and an Application Load Balancer</span></h2>
<p><span>In this phase, you will create an Application Load Balancer, which provides an endpoint URL. This URL will act
        as the HTTPS entry point for customers and employees to access your application through a web browser. The load
        balancer will have listeners, which will have routing and access rules that determine which target group of
        running containers the user request should be directed to.</span></p>
<h3 id="a-idp6t1atask-61-create-four-target-groups"><a id="p6t1"></a><span>Task 6.1: Create four target groups</span>
</h3>
<p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
<p><span>In this task, you will create four target groups—two for each microservice. Because you will configure a
        blue/green deployment, CodeDeploy requires two target groups for each deployment group.</span></p>
<p><i class="fa-solid fa-note-sticky" aria-label="Note icon"></i><span> </span><strong><span>Note:</span></strong><span>
        Blue/green is a deployment strategy where you create two separate but identical environments. One environment
        (blue) runs the current application version, and one environment (green) runs the new application version. For
        more information, see </span><a
        href="https://docs.aws.amazon.com/whitepapers/latest/overview-deployment-options/bluegreen-deployments.html"
        target="_blank" rel="noopener noreferrer"><span>Blue/Green Deployments</span></a><span> in the
    </span><em><span>Overview of Deployment Options on AWS</span></em><span> whitepaper.</span></p>
<p>&nbsp;</p>
<ol start="">
    <li>
        <p><span>Create the first target group for the </span><em><span>customer</span></em><span> microservice.</span>
        </p>
        <ul>
            <li>
                <p><span>Navigate to the Amazon EC2 console.</span></p>
            </li>
            <li>
                <p><span>In the navigation pane, choose </span><strong><span>Target Groups</span></strong><span>.</span>
                </p>
            </li>
            <li>
                <p><span>Choose </span><strong><span>Create target group</span></strong><span> and configure the
                        following:</span></p>
                <ul>
                    <li>
                        <p><strong><span>Choose a target type:</span></strong><span> Choose </span><strong><span>IP
                                    addresses</span></strong><span>.</span></p>
                    </li>
                    <li>
                        <p><strong><span>Target group name:</span></strong><span> Enter
                            </span><code>customer-tg-one</code></p>
                    </li>
                    <li>
                        <p><strong><span>Protocol:</span></strong><span> Choose
                            </span><strong><span>HTTP</span></strong><span>.</span></p>
                    </li>
                    <li>
                        <p><strong><span>Port:</span></strong><span> Enter </span><code>8080</code></p>
                    </li>
                    <li>
                        <p><strong><span>VPC:</span></strong><span> Choose
                            </span><strong><span>LabVPC</span></strong><span>.</span></p>
                    </li>
                    <li>
                        <p><strong><span>Health check path:</span></strong><span> Enter </span><code>/</code></p>
                    </li>
                </ul>
            </li>
            <li>
                <p><span>Choose </span><strong><span>Next</span></strong><span>.</span></p>
            </li>
            <li>
                <p><span>On the </span><strong><span>Register targets</span></strong><span> page, accept all defaults
                        (don't register any targets), and choose </span><strong><span>Create target
                            group</span></strong><span>.</span></p>
            </li>
        </ul>
    </li>
</ol>
<ol start="2">
    <li>
        <p><span>Create a second target group for the </span><em><span>customer</span></em><span> microservice. Use the
                same settings as the first target group except use </span><code>customer-tg-two</code><span> as the
                target group name.</span></p>
    </li>
    <li>
        <p><span>Create a target group for the </span><em><span>employee</span></em><span> microservice. Use the same
                settings as the other target groups with the following exceptions:</span></p>
        <ul>
            <li>
                <p><strong><span>Target group name:</span></strong><span> Enter </span><code>employee-tg-one</code></p>
            </li>
            <li>
                <p><strong><span>Health check path:</span></strong><span> Enter </span><code>/admin/suppliers</code></p>
            </li>
        </ul>
    </li>
</ol>
<ol start="4">
    <li>
        <p><span>Create a second target group for the </span><em><span>employee</span></em><span> microservice. Use the
                same settings as the other target groups with the following exceptions:</span></p>
        <ul>
            <li>
                <p><strong><span>Target group name:</span></strong><span> Enter </span><code>employee-tg-two</code></p>
            </li>
            <li>
                <p><strong><span>Health check path:</span></strong><span> Enter </span><code>/admin/suppliers</code></p>
                <p><i class="fa-solid fa-circle-exclamation" aria-label="Important icon"></i><span>
                    </span><strong><span>Important:</span></strong><span> Carefully confirm the name and port number of
                        each target group. The following image provides an example:</span></p>
                <p><span> </span><img src="images/all-four-tgs.png" referrerpolicy="no-referrer"
                        alt="List of the four target groups and their port numbers."></p>
            </li>
        </ul>
    </li>
</ol>
<p>&nbsp;</p>
<h3 id="a-idp6t2atask-62-create-a-security-group-and-an-application-load-balancer-and-configure-rules-to-route-traffic">
    <a id="p6t2"></a><span>Task 6.2: Create a security group and an Application Load Balancer, and configure rules to
        route traffic</span></h3>
<p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
<p><span>In this task, you will create an Application Load Balancer. You will also define two listeners for the load
        balancer: one on port 80 and another on port 8080. For each listener, you will then define path-based routing
        rules so that traffic is routed to the correct target group depending on the URL that a user attempts to
        load.</span></p>
<p>&nbsp;</p>
<ol start="">
    <li>
        <p><span>Create a new EC2 security group named </span><code>microservices-sg</code><span> to use in
            </span><em><span>LabVPC</span></em><span>. Add inbound rules that allow TCP traffic from any IPv4 address on
                ports 80 and 8080.</span></p>
    </li>
    <li>
        <p><span>In the Amazon EC2 console, create an Application Load Balancer named
            </span><code>microservicesLB</code><span>.</span></p>
        <ul>
            <li>
                <p><span>Make it internet facing for IPv4 addresses.</span></p>
            </li>
            <li>
                <p><span>Use </span><em><span>LabVPC</span></em><span>, </span><em><span>Public
                            Subnet1</span></em><span>, </span><em><span>Public Subnet2</span></em><span>, and the
                    </span><em><span>microservices-sg</span></em><span> security group.</span></p>
            </li>
            <li>
                <p><span>Configure two listeners on it. The first should listen on
                    </span><em><span>HTTP:80</span></em><span> and forward traffic to
                    </span><em><span>customer-tg-two</span></em><span> by default. The second should listen on
                    </span><em><span>HTTP:8080</span></em><span> and forward traffic to
                    </span><em><span>customer-tg-one</span></em><span> by default.</span></p>
            </li>
        </ul>
    </li>
</ol>
<ol start="3">
    <li>
        <p><span>Add a second rule for the </span><em><span>HTTP:80</span></em><span> listener. Define the following
                logic for this new rule:</span></p>
        <ul>
            <li>
                <p><span>IF </span><strong><span>Path</span></strong><span> is </span><code>/admin/*</code><span>
                    </span></p>
            </li>
            <li>
                <p><span>THEN </span><strong><span>Forward to...</span></strong><span> the
                    </span><strong><span>employee-tg-two</span></strong><span> target group.</span></p>
                <p><span>The settings should be the same as shown in the following image:</span></p>
                <p><img src="images/LB-rules-80.png" referrerpolicy="no-referrer" alt="Rules for the HTTP:80 listener.">
                </p>
            </li>
        </ul>
    </li>
</ol>
<ol start="4">
    <li>
        <p><span>Add a second rule for the </span><em><span>HTTP:8080</span></em><span> listener. Define the following
                logic for this new rule:</span></p>
        <ul>
            <li>
                <p><span>IF </span><strong><span>Path</span></strong><span> is </span><code>/admin/*</code><span>
                    </span></p>
            </li>
            <li>
                <p><span>THEN </span><strong><span>Forward to</span></strong><span> the
                    </span><strong><span>employee-tg-one</span></strong><span> target group.</span></p>
                <p><span>The settings should be the same as shown in the following image:</span></p>
                <p><img src="images/LB-rules-8080.png" referrerpolicy="no-referrer"
                        alt="Rules for the HTTP:8080 listener."></p>
            </li>
        </ul>
    </li>
</ol>
<h2 id="a-idp7aphase-7-creating-two-amazon-ecs-services"><a id="p7"></a><span>Phase 7: Creating two Amazon ECS
        services</span></h2>
<p><span>In this phase, you will create a service in Amazon ECS for each microservice. Although you could deploy both
        microservices to a single ECS service, for this project, it will be easier to manage the microservices
        independently if each is deployed to its own ECS service.</span></p>
<h3 id="a-idp7t1atask-71-create-the-ecs-service-for-the-customer-microservice"><a id="p7t1"></a><span>Task 7.1: Create
        the ECS service for the </span><em><span>customer</span></em><span> microservice</span></h3>
<p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
<p>&nbsp;</p>
<ol start="">
    <li>
        <p><span>In AWS Cloud9, create a new file named
            </span><code>create-customer-microservice-tg-two.json</code><span> in the
            </span><strong><span>deployment</span></strong><span> directory.</span></p>
    </li>
    <li>
        <p><span>Paste the following JSON code into the file:</span></p>
        <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="json"
            style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="json"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre>
        </div>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"taskDefinition"</span>: <span class="cm-string">"customer-microservice:REVISION-NUMBER"</span>,</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"cluster"</span>: <span class="cm-string">"microservices-serverlesscluster"</span>,</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"loadBalancers"</span>: [</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"targetGroupArn"</span>: <span class="cm-string">"MICROSERVICE-TG-TWO-ARN"</span>,</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"containerName"</span>: <span class="cm-string">"customer"</span>,</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"containerPort"</span>: <span class="cm-number">8080</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ],</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"desiredCount"</span>: <span class="cm-number">1</span>,</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"launchType"</span>: <span class="cm-string">"FARGATE"</span>,</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"schedulingStrategy"</span>: <span class="cm-string">"REPLICA"</span>,</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"deploymentController"</span>: {</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"type"</span>: <span class="cm-string">"CODE_DEPLOY"</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  },</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"networkConfiguration"</span>: {</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"awsvpcConfiguration"</span>: {</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"subnets"</span>: [</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"PUBLIC-SUBNET-1-ID"</span>,</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"PUBLIC-SUBNET-2-ID"</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ],</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"securityGroups"</span>: [</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"SECURITY-GROUP-ID"</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ],</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"assignPublicIp"</span>: <span class="cm-string">"ENABLED"</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre>
        </div>
        </div>
        </div>
        </div>
        </div>
        <div
            style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 638px;">
        </div>
        <div class="CodeMirror-gutters" style="display: none; height: 638px;"></div>
        </div>
        </div>
        </pre>
    </li>
    <li>
        <p><span>Edit the </span><strong><span>create-customer-microservice-tg-two.json</span></strong><span>
                file:</span></p>
        <ul>
            <li>
                <p><span>Replace </span><strong><span>REVISION-NUMBER</span></strong><span> with the number of the
                        latest revision of the </span><em><span>customer-microservice</span></em><span> task definition
                        that is registered with Amazon ECS.</span></p>
                <ul>
                    <li>
                        <p><span>If this is the first time that you are completing this step, the revision number should
                                be </span><code>1</code><span>.</span></p>
                    </li>
                    <li>
                        <p><span>If you are repeating this step, find the latest revision number in the Amazon ECS
                                console by choosing </span><strong><span>Task definitions</span></strong><span>, and
                                then choosing </span><strong><span>customer-microservice</span></strong><span>.</span>
                        </p>
                    </li>
                </ul>
            </li>
        </ul>
        <ul>
            <li>
                <p><span>Replace </span><strong><span>MICROSERVICE-TG-TWO-ARN</span></strong><span> with the actual ARN
                        of the </span><em><span>customer-tg-two</span></em><span> target group.</span></p>
            </li>
            <li>
                <p><span>Replace </span><strong><span>PUBLIC-SUBNET-1-ID</span></strong><span> with the actual subnet ID
                        of </span><em><span>Public Subnet1</span></em><span>.</span></p>
            </li>
            <li>
                <p><span>Replace </span><strong><span>PUBLIC-SUBNET-2-ID</span></strong><span> with the actual subnet ID
                        of </span><em><span>Public Subnet2</span></em><span>.</span></p>
            </li>
            <li>
                <p><span>Replace </span><strong><span>SECURITY-GROUP-ID</span></strong><span> with the actual security
                        group ID of </span><em><span>microservices-sg</span></em><span>.</span></p>
            </li>
            <li>
                <p><span>Save the changes.</span></p>
            </li>
        </ul>
    </li>
</ol>
<ol start="4">
    <li>
        <p><span>To create the Amazon ECS service for the </span><em><span>customer</span></em><span> microservice, run
                the following commands:</span></p>
        <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false"
            lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">cd</span> ~/environment/deployment</span></pre>
        </div>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">aws ecs create-service <span class="cm-attribute">--service-name</span> customer-microservice <span class="cm-attribute">--cli-input-json</span> file://create-customer-microservice-tg-two.json</span></pre>
        </div>
        </div>
        </div>
        </div>
        </div>
        <div
            style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 66px;">
        </div>
        <div class="CodeMirror-gutters" style="display: none; height: 66px;"></div>
        </div>
        </div>
        </pre>
        <p><i class="fa-solid fa-lightbulb" aria-label="Tip icon"></i><span> </span><strong><span>Troubleshooting
                    tip:</span></strong><span> If you are repeating this step and previously created the ECS service,
                you might receive an error about the creation of the service not being idempotent. To resolve this
                error, force delete the service from the Amazon ECS console, wait for it to drain, and then run the
                commands again.</span></p>
    </li>
</ol>
<p>&nbsp;</p>
<h3 id="a-idp7t2atask-72-create-the-amazon-ecs-service-for-the-employee-microservice"><a id="p7t2"></a><span>Task 7.2:
        Create the Amazon ECS service for the </span><em><span>employee</span></em><span> microservice</span></h3>
<p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
<p>&nbsp;</p>
<ol start="">
    <li>
        <p><span>Create an Amazon ECS service for the </span><em><span>employee</span></em><span> microservice.</span>
        </p>
        <ul>
            <li>
                <p><span>Copy the JSON file that you created for the </span><em><span>customer</span></em><span>
                        microservice, and name it </span><code>create-employee-microservice-tg-two.json</code><span>.
                        Save it in the same directory.</span></p>
            </li>
            <li>
                <p><span>Modify the </span><strong><span>create-employee-microservice-tg-two.json</span></strong><span>
                        file:</span></p>
                <ul>
                    <li>
                        <p><span>On line 2, change </span><code>customer-microservice</code><span> to
                            </span><code>employee-microservice</code><span> and also update the
                            </span><strong><span>revision number</span></strong><span>.</span></p>
                    </li>
                    <li>
                        <p><span>On line 6, enter the ARN of the
                            </span><strong><span>employee-tg-two</span></strong><span> target group.</span></p>
                        <p><i class="fa-solid fa-lightbulb" aria-label="Tip icon"></i><span>
                            </span><strong><span>Tip:</span></strong><span> Don't just change
                            </span><code>customer</code><span> to </span><code>employee</code><span> on this line. The
                                ARN is unique in other ways.</span></p>
                    </li>
                    <li>
                        <p><span>On line 7, change </span><code>customer</code><span> to </span><code>employee</code>
                        </p>
                    </li>
                </ul>
            </li>
            <li>
                <p><span>Save the changes.</span></p>
            </li>
        </ul>
    </li>
</ol>
<ol start="2">
    <li>
        <p><span>Run the appropriate AWS CLI command to create the service in Amazon ECS.</span></p>
        <p><i class="fa-solid fa-note-sticky" aria-label="Note icon"></i><span>
            </span><strong><span>Note:</span></strong><span> If you go to the Amazon ECS console and look at the
                services in the cluster, you might see </span><em><span>0/1 Task running</span></em><span>, as shown in
                the following image. This is expected for now because you haven't launched task sets for these services
                yet.</span></p>
        <p><img src="images/after-service-creation.png" referrerpolicy="no-referrer" alt="after service creation"></p>
    </li>
</ol>
<h2 id="a-idp8aphase-8-configuring-codedeploy-and-codepipeline"><a id="p8"></a><span>Phase 8: Configuring CodeDeploy and
        CodePipeline</span></h2>
<p><span>Now that you have defined the Application Load Balancer, target groups, and the Amazon ECS services that
        comprise the infrastructure that you will deploy your microservices to, the next step is to define the CI/CD
        pipeline to deploy the application.</span></p>
<p><span>The following diagram illustrates the role of the pipeline in the solution that you are building.</span></p>
<p><img src="images/pipeline-diagram.png" referrerpolicy="no-referrer"
        alt="Pipeline diagram. See description after image."></p>
<p><em><span>Diagram description:</span></em><span> The pipeline will be invoked by updates to CodeCommit, where you
        have stored the ECS task definition files and the CodeDeploy AppSpec files. The pipeline can also be invoked by
        updates to one of the Docker image files that you have stored in Amazon ECR. When invoked, the pipeline will
        call the CodeDeploy service to deploy the updates. CodeDeploy will take the necessary actions to deploy the
        updates to the green environment. Assuming that no errors occur, the new task set will replace the existing task
        set.</span></p>
<h3 id="a-idp8t1atask-81-create-a-codedeploy-application-and-deployment-groups"><a id="p8t1"></a><span>Task 8.1: Create
        a CodeDeploy application and deployment groups</span></h3>
<p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
<p><span>A CodeDeploy application is a collection of deployment groups and revisions. A deployment group specifies an
        Amazon ECS service, load balancer, optional test listener, and two target groups. A group specifies when to
        reroute traffic to the replacement task set, and when to terminate the original task set and Amazon ECS
        application after a successful deployment.</span></p>
<p>&nbsp;</p>
<ol start="">
    <li>
        <p><span>Use the CodeDeploy console to create a CodeDeploy application with the name
            </span><code>microservices</code><span> that uses Amazon ECS as the compute platform.</span></p>
        <p><i class="fa-solid fa-lightbulb" aria-label="Tip icon"></i><span>
            </span><strong><span>Tip:</span></strong><span> See </span><a
                href="https://docs.aws.amazon.com/codedeploy/latest/userguide/applications-create-ecs.html"
                target="_blank" rel="noopener noreferrer"><span>Create an Application for an Amazon ECS Service
                    Deployment (Console)</span></a><span> in the </span><em><span>AWS CodeDeploy User
                    Guide</span></em><span>.</span></p>
        <p><i class="fa-solid fa-circle-exclamation" aria-label="Important icon"></i><span>
            </span><strong><span>Important:</span></strong><span> </span><em><span>DON'T</span></em><span> create a
                deployment group yet. You will do that in the next step.</span></p>
    </li>
</ol>
<ol start="2">
    <li>
        <p><span>Create a CodeDeploy deployment group for the </span><em><span>customer</span></em><span>
                microservice.</span></p>
        <ul>
            <li>
                <p><span>On the </span><em><span>microservices</span></em><span> application detail page, choose the
                    </span><strong><span>Deployment groups</span></strong><span> tab.</span></p>
            </li>
            <li>
                <p><span>Choose </span><strong><span>Create deployment group</span></strong><span> and configure the
                        following:</span></p>
                <ul>
                    <li>
                        <p><strong><span>Deployment group name:</span></strong><span> Enter
                            </span><code>microservices-customer</code></p>
                    </li>
                    <li>
                        <p><strong><span>Service role:</span></strong><span> Place your cursor in the search box, and
                                choose the ARN for </span><strong><span>DeployRole</span></strong><span>.</span></p>
                    </li>
                    <li>
                        <p><span>In the </span><strong><span>Environment configuration</span></strong><span>
                                section:</span></p>
                        <ul>
                            <li>
                                <p><strong><span>ECS cluster name:</span></strong><span> Choose
                                    </span><strong><span>microservices-serverlesscluster</span></strong><span>.</span>
                                </p>
                            </li>
                            <li>
                                <p><strong><span>ECS service name:</span></strong><span> Choose
                                    </span><strong><span>customer-microservice</span></strong><span>.</span></p>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <p><span>In the </span><strong><span>Load balancers</span></strong><span> section:</span></p>
                        <ul>
                            <li>
                                <p><strong><span>Load balancer:</span></strong><span> Choose
                                    </span><strong><span>microservicesLB</span></strong><span>.</span></p>
                            </li>
                            <li>
                                <p><strong><span>Production listener port:</span></strong><span> Choose
                                    </span><strong><span>HTTP:80</span></strong><span>.</span></p>
                            </li>
                            <li>
                                <p><strong><span>Test listener port:</span></strong><span> Choose
                                    </span><strong><span>HTTP:8080</span></strong><span>.</span></p>
                            </li>
                            <li>
                                <p><strong><span>Target group 1 name:</span></strong><span> Choose
                                    </span><strong><span>customer-tg-two</span></strong><span>.</span></p>
                            </li>
                            <li>
                                <p><strong><span>Target group 2 name:</span></strong><span> Choose
                                    </span><strong><span>customer-tg-one</span></strong><span>.</span></p>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <p><span>In the </span><strong><span>Deployment settings</span></strong><span> section:</span>
                        </p>
                        <ul>
                            <li>
                                <p><strong><span>Traffic rerouting:</span></strong><span> Choose
                                    </span><strong><span>Reroute traffic immediately</span></strong><span>.</span></p>
                            </li>
                            <li>
                                <p><strong><span>Deployment configuration:</span></strong><span> Choose
                                    </span><strong><span>CodeDeployDefault.ECSAllAtOnce</span></strong><span>.</span>
                                </p>
                            </li>
                            <li>
                                <p><strong><span>Original revision termination:</span></strong><span> Days:
                                    </span><strong><span>0</span></strong><span>, Hours:
                                    </span><strong><span>0</span></strong><span>, Minutes:
                                    </span><strong><span>5</span></strong></p>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <p><span>Choose </span><strong><span>Create deployment group</span></strong><span>.</span></p>
                    </li>
                </ul>
            </li>
        </ul>
    </li>
</ol>
<ol start="3">
    <li>
        <p><span>Create a CodeDeploy deployment group for the </span><em><span>employee</span></em><span> microservice.
                Specify the same settings that you did in the prior step, except for the following:</span></p>
        <ul>
            <li>
                <p><strong><span>Deployment group name:</span></strong><span> Enter
                    </span><code>microservices-employee</code></p>
            </li>
            <li>
                <p><strong><span>ECS service name:</span></strong><span> Choose
                    </span><strong><span>employee-microservice</span></strong><span>.</span></p>
            </li>
            <li>
                <p><strong><span>Target group 1 name:</span></strong><span> Choose
                    </span><strong><span>employee-tg-two</span></strong><span>.</span></p>
            </li>
            <li>
                <p><strong><span>Target group 2 name:</span></strong><span> Choose
                    </span><strong><span>employee-tg-one</span></strong><span>.</span></p>
                <p>&nbsp;</p>
            </li>
        </ul>
    </li>
</ol>
<h3 id="a-idp8t2atask-82-create-a-pipeline-for-the-customer-microservice"><a id="p8t2"></a><span>Task 8.2: Create a
        pipeline for the </span><em><span>customer</span></em><span> microservice</span></h3>
<p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
<p><span>In this task, you will create a pipeline to update the </span><em><span>customer</span></em><span>
        microservice. When you first define the pipeline, you will configure CodeCommit as the source and CodeDeploy as
        the service that is responsible for deployment. You will then edit the pipeline to add the Amazon ECR service as
        a second source.</span></p>
<p><span>With an Amazon ECS blue/green deployment, which you will specify in this task, you provision a new set of
        containers, which CodeDeploy installs the latest version of your application on. CodeDeploy then reroutes load
        balancer traffic from an existing set of containers, which run the previous version of your application, to the
        new set of containers, which run the latest version. After traffic is rerouted to the new containers, the
        existing containers can be terminated. With a blue/green deployment, you can test the new application version
        before sending production traffic to it.</span></p>
<p><strong><span>References</span></strong></p>
<ul>
    <li>
        <p><span>The AWS Academy Cloud Architecting and AWS Academy Cloud Developing courses include hands-on labs that
                explore CodePipeline features.</span></p>
    </li>
    <li>
        <p><a href="https://docs.aws.amazon.com/codepipeline/latest/userguide/welcome.html" target="_blank"
                rel="noopener noreferrer"><span>AWS CodePipeline User Guide</span></a></p>
    </li>
</ul>
<p>&nbsp;</p>
<ol start="">
    <li>
        <p><span>In the CodePipeline console, create a </span><em><span>customer</span></em><span> pipeline with the
                following settings:</span></p>
        <ul>
            <li>
                <p><strong><span>Pipeline name:</span></strong><span> Enter
                    </span><code>update-customer-microservice</code></p>
            </li>
            <li>
                <p><strong><span>Service role:</span></strong><span> Choose the ARN for
                    </span><strong><span>PipelineRole</span></strong><span>.</span></p>
            </li>
            <li>
                <p><strong><span>Source provider:</span></strong><span> Choose </span><strong><span>AWS
                            CodeCommit</span></strong><span>.</span></p>
                <ul>
                    <li>
                        <p><strong><span>Repository name:</span></strong><span> Choose
                            </span><strong><span>deployment</span></strong><span>.</span></p>
                    </li>
                </ul>
                <p><span> </span><i class="fa-solid fa-note-sticky" aria-label="Note icon"></i><span>
                    </span><strong><span>Note:</span></strong><span> You have defined two CodeCommit repositories. The
                    </span><em><span>deployment</span></em><span> repository contains the Amazon ECS task definition
                        files and CodeDeploy AppSpec files that your pipeline will need, so that is the one you choose
                        here.</span></p>
                <ul>
                    <li>
                        <p><strong><span>Branch name:</span></strong><span> Choose
                            </span><strong><span>dev</span></strong><span>.</span></p>
                    </li>
                </ul>
                <p><i class="fa-solid fa-note-sticky" aria-label="Note icon"></i><span>
                    </span><strong><span>Note:</span></strong><span> </span><em><span>Skip</span></em><span> the build
                        stage.</span></p>
            </li>
            <li>
                <p><strong><span>Deploy provider:</span></strong><span> </span><strong><span>Amazon ECS
                            (Blue/Green)</span></strong></p>
                <ul>
                    <li>
                        <p><strong><span>Region:</span></strong><span> US East (N. Virginia).</span></p>
                    </li>
                    <li>
                        <p><strong><span>AWS CodeDeploy application name:</span></strong><span> microservices</span></p>
                    </li>
                    <li>
                        <p><strong><span>AWS CodeDeploy deployment group:</span></strong><span>
                                microservices-customer</span></p>
                    </li>
                    <li>
                        <p><span>Under </span><strong><span>Amazon ECS task definition</span></strong><span>:</span></p>
                        <ul>
                            <li>
                                <p><span>Set a </span><strong><span>SourceArtifact</span></strong><span> with a value of
                                    </span><code>taskdef-customer.json</code></p>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <p><span>Under </span><strong><span>AWS CodeDeploy AppSpec file</span></strong><span>:</span>
                        </p>
                        <ul>
                            <li>
                                <p><span>Set a </span><strong><span>SourceArtifact</span></strong><span> with a value of
                                    </span><code>appspec-customer.yaml</code></p>
                                <p><i class="fa-solid fa-note-sticky" aria-label="Note icon"></i><span>
                                    </span><strong><span>Note:</span></strong><span> Leave the
                                    </span><em><span>Dynamically update task definition image</span></em><span> fields
                                    </span><em><span>blank</span></em><span> for now.</span></p>
                            </li>
                        </ul>
                    </li>
                </ul>
            </li>
        </ul>
        <p><i class="fa-solid fa-note-sticky" aria-label="Note icon"></i><span>
            </span><strong><span>Note:</span></strong><span> After you create the pipeline, it will immediately start to
                run and will eventually fail on the </span><em><span>Deploy</span></em><span> stage. Ignore that for now
                and continue to the next step.</span></p>
    </li>
    <li>
        <p><span>Edit the </span><em><span>update-customer-microservice</span></em><span> pipeline to add another
            </span><em><span>source</span></em><span>.</span></p>
        <ul>
            <li>
                <p><span>In the </span><strong><span>Edit: Source</span></strong><span> section, choose
                    </span><strong><span>Edit stage</span></strong><span>, then add an action with these details:</span>
                </p>
                <ul>
                    <li>
                        <p><strong><span>Action name:</span></strong><span> </span><code>Image</code></p>
                    </li>
                    <li>
                        <p><strong><span>Action provider:</span></strong><span> Amazon ECR</span></p>
                    </li>
                    <li>
                        <p><strong><span>Repository name:</span></strong><span> customer</span></p>
                    </li>
                    <li>
                        <p><strong><span>Image tag:</span></strong><span> latest</span></p>
                    </li>
                    <li>
                        <p><strong><span>Output artifacts:</span></strong><span> </span><code>image-customer</code></p>
                    </li>
                </ul>
            </li>
        </ul>
    </li>
    <li>
        <p><span>Edit the </span><em><span>deploy</span></em><span> action of the
            </span><em><span>update-customer-microservice</span></em><span> pipeline.</span></p>
        <ul>
            <li>
                <p><span>Edit the </span><strong><span>update-customer-microservice</span></strong><span>
                        pipeline</span></p>
                <ul>
                    <li>
                        <p><span>In the </span><strong><span>Edit: Deploy</span></strong><span> section, choose
                            </span><strong><span>Edit stage</span></strong><span>, then add an input artifact as
                                described below:</span></p>
                        <ul>
                            <li>
                                <p><span>On the </span><strong><span>Deploy Amazon ECS
                                            (Blue/Green)</span></strong><span> card, choose the edit (pencil)
                                        icon.</span></p>
                            </li>
                            <li>
                                <p><span>Under </span><strong><span>Input artifacts</span></strong><span>, choose
                                    </span><strong><span>Add</span></strong><span> and then choose
                                    </span><strong><span>image-customer</span></strong><span>.</span></p>
                            </li>
                        </ul>
                        <p><i class="fa-solid fa-note-sticky" aria-label="Note icon"></i><span>
                            </span><strong><span>Note:</span></strong><span> You should now have
                            </span><em><span>SourceArtifact</span></em><span> and
                            </span><em><span>image-customer</span></em><span> as listed input artifacts.</span></p>
                    </li>
                    <li>
                        <p><span>Under </span><strong><span>Dynamically update task definition
                                    image</span></strong><span>, for </span><strong><span>Input artifact with image
                                    details</span></strong><span>, choose
                            </span><strong><span>image-customer</span></strong><span>.</span></p>
                    </li>
                    <li>
                        <p><span>For </span><strong><span>Placeholder text in the task definition</span></strong><span>,
                                enter </span><code>IMAGE1_NAME</code></p>
                    </li>
                </ul>
            </li>
        </ul>
    </li>
</ol>
<p><strong><span>Analysis:</span></strong><span> Recall that in a previous phase, you entered the
    </span><em><span>IMAGE1_NAME</span></em><span> placeholder text in the
    </span><em><span>taskdef-customer.json</span></em><span> file before you pushed it to CodeCommit. In this current
        task, you configured the logic that will replace the placeholder text with the actual image name that the source
        phase of the CodePipeline returns.</span></p>
<p><span> </span></p>
<h3 id="a-idp8t3atask-83-test-the-cicd-pipeline-for-the-customer-microservice"><a id="p8t3"></a><span>Task 8.3: Test the
        CI/CD pipeline for the </span><em><span>customer</span></em><span> microservice</span></h3>
<p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
<p><span>In this task, you will test that the CI/CD pipeline for the </span><em><span>customer</span></em><span>
        microservice functions as intended.</span></p>
<p><i class="fa-solid fa-circle-exclamation" aria-label="Important icon"></i><span>
    </span><strong><span>Important:</span></strong><span> If you are repeating this task, confirm that all target groups
        are still associated with the Application Load Balancer. The </span><a href="#app2" target="_self"
        rel="noopener noreferrer"><span>Reassociate Target Groups with Load Balancer</span></a><span> section of the
        appendix provides more detail.</span></p>
<ol start="">
    <li>
        <p><span>Launch a deployment of the </span><em><span>customer</span></em><span> microservice on Amazon ECS on
                Fargate.</span></p>
        <ul>
            <li>
                <p><span>Navigate to the CodePipeline console.</span></p>
            </li>
            <li>
                <p><span>On the </span><strong><span>Pipelines</span></strong><span> page, choose the link for the
                        pipeline that is named
                    </span><strong><span>update-customer-microservice</span></strong><span>.</span></p>
            </li>
            <li>
                <p><span>To force a test of the current pipeline settings, choose </span><strong><span>Release
                            change</span></strong><span>, and then choose
                    </span><strong><span>Release</span></strong><span>.</span></p>
                <p><i class="fa-solid fa-note-sticky" aria-label="Note icon"></i><span>
                    </span><strong><span>Note:</span></strong><span> By invoking the pipeline, you created a new
                        revision of the task definition.</span></p>
                <p><span>Wait for the two </span><em><span>Source</span></em><span> tasks to show a status of
                    </span><em><span>Succeeded - just now</span></em><span>.</span></p>
            </li>
            <li>
                <p><span>In the </span><strong><span>Deploy</span></strong><span> section, wait for a
                    </span><strong><span>Details</span></strong><span> link to appear, and then click the link.</span>
                </p>
                <p><span>A CodeDeploy page opens in a new browser tab.</span></p>
            </li>
        </ul>
    </li>
    <li>
        <p><span>Observe the progress in CodeDeploy.</span></p>
        <ul>
            <li>
                <p><span>Scroll to the bottom of the page, and notice the </span><strong><span>Deployment lifecycle
                            events</span></strong><span> section.</span></p>
                <p><i class="fa-solid fa-lightbulb" aria-label="Tip icon"></i><span>
                    </span><strong><span>Tip:</span></strong><span> If you see a "Primary task group must be behind
                        listener" error, refer to the </span><a href="#app2" target="_self"
                        rel="noopener noreferrer"><span>Reassociate Target Groups with Load Balancer</span></a><span>
                        section in the appendix.</span></p>
                <p><span>Within a few minutes, if everything was configured correctly, all of the deployment lifecycle
                        events should succeed. Don't wait for that to happen—move to the next step. Keep this page
                        open.</span></p>
            </li>
        </ul>
    </li>
    <li>
        <p><span>Load the </span><em><span>customer</span></em><span> microservice in a browser tab and test it.</span>
        </p>
        <ul>
            <li>
                <p><span>Locate the </span><strong><span>DNS name</span></strong><span> value of the
                    </span><strong><span>microservicesLB</span></strong><span> load balancer, and paste it into a new
                        browser tab.</span></p>
            </li>
            <li>
                <p><span>The customer microservice loads. If it doesn't load, add </span><code>:8080</code><span> to the
                        end of the URL and try again.</span></p>
                <p><strong><span>Analysis:</span></strong><span> Recall that your load balancer has two listeners: one
                        on port 80 and another on port 8080. Port 8080 is where the replacement task set will run for
                        the first 5 minutes. Therefore, if you load the :80 URL within the first 5 minutes, the customer
                        microservice page might not load, but you should already see the page at 8080. Then, after 5
                        minutes, you should see that the microservice is available at both ports.</span></p>
            </li>
            <li>
                <p><span>In the café web application, choose </span><strong><span>List of
                            suppliers</span></strong><span> or </span><strong><span>Suppliers
                            list</span></strong><span>.</span></p>
                <p><span>The suppliers page loads. It should </span><em><span>not</span></em><span> have the edit or add
                        supplier buttons because it is a customer page.</span></p>
            </li>
        </ul>
    </li>
    <li>
        <p><span>Observe the running tasks in the Amazon ECS console.</span></p>
        <ul>
            <li>
                <p><span>Navigate to the Amazon ECS console.</span></p>
            </li>
            <li>
                <p><span>In the clusters list, choose the link for
                    </span><strong><span>microservices-serverlesscluster</span></strong><span>.</span></p>
                <p><span>On the </span><strong><span>Services</span></strong><span> tab, notice that the
                    </span><em><span>customer-microservice</span></em><span> service appears. The
                    </span><strong><span>Deployments and tasks</span></strong><span> status will change as the
                        blue/green deployment advances through its lifecycle events.</span></p>
            </li>
            <li>
                <p><span>Choose the </span><strong><span>Tasks</span></strong><span> tab.</span></p>
                <p><span>Here you can see the actual tasks that are running. You might have more than one task running
                        per service that you defined.</span></p>
            </li>
            <li>
                <p><span>Choose the link for one of the listed tasks. You might only have one.</span></p>
                <p><span>Here you can see the actual container details and the configuration information, such as the IP
                        addresses that are associated with the running container.</span></p>
            </li>
        </ul>
    </li>
    <li>
        <p><span>Return to the CodeDeploy page that is open in another browser tab.</span></p>
        <p><span>You should now see that all five steps of the deployment succeeded and the replacement task set is now
                serving traffic.</span></p>
    </li>
    <li>
        <p><span>Observe the load balancer and target group settings.</span></p>
        <ul>
            <li>
                <p><span>In the Amazon EC2 console, choose </span><strong><span>Target
                            Groups</span></strong><span>.</span></p>
                <p><span>You might notice that the </span><em><span>customer-tg-two</span></em><span> target group is no
                        longer associated with the load balancer. This is because CodeDeploy is managing the load
                        balancer listener rules and might have determined that some of the target groups are no longer
                        needed.</span></p>
            </li>
            <li>
                <p><span>Observe the HTTP:80 listener rules.</span></p>
                <p><span>The default rule has changed here. The default "if no other rule applies" rule previously
                        pointed to </span><em><span>customer-tg-two</span></em><span>, but now it points to
                    </span><em><span>customer-tg-one</span></em><span>. This is because CodeDeploy actively managed your
                        Application Load Balancer.</span></p>
            </li>
            <li>
                <p><span>Observe the HTTP:8080 listener rules.</span></p>
                <p><span>The two rules still forward to the "one" target groups.</span></p>
            </li>
        </ul>
    </li>
</ol>
<p><span>Congratulations! You successfully deployed one of the two microservices to Amazon ECS on Fargate by using a
        CI/CD pipeline.</span></p>
<p>&nbsp;</p>
<h3 id="a-idp8t4atask-84-create-a-pipeline-for-the-employee-microservice"><a id="p8t4"></a><span>Task 8.4: Create a
        pipeline for the </span><em><span>employee</span></em><span> microservice</span></h3>
<p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
<p><span>In this task, you will create the pipeline for the </span><em><span>employee</span></em><span>
        microservice.</span></p>
<p>&nbsp;</p>
<ol start="">
    <li>
        <p><span>Create a pipeline for the </span><em><span>employee</span></em><span> microservice with the following
                specifications:</span></p>
        <ul>
            <li>
                <p><span>Pipeline name: </span><code>update-employee-microservice</code></p>
            </li>
            <li>
                <p><span>Role ARN: </span><strong><span>PipelineRole</span></strong></p>
                <ul>
                    <li>
                        <p><span>Source provider: </span><strong><span>AWS CodeCommit</span></strong></p>
                        <ul>
                            <li>
                                <p><span>Repository name: </span><strong><span>deployment</span></strong></p>
                            </li>
                            <li>
                                <p><span>Branch name: </span><strong><span>dev</span></strong></p>
                            </li>
                        </ul>
                    </li>
                </ul>
            </li>
            <li>
                <p><span>Deploy provider: </span><strong><span>Amazon ECS (Blue/Green)</span></strong></p>
            </li>
            <li>
                <p><span>AWS CodeDeploy application name: </span><strong><span>microservices</span></strong></p>
            </li>
            <li>
                <p><span>AWS CodeDeploy deployment group: </span><strong><span>microservices-employee</span></strong>
                </p>
            </li>
            <li>
                <p><span>Amazon ECS task definition: </span><strong><span>SourceArtifact</span></strong></p>
                <ul>
                    <li>
                        <p><span>Path: </span><code>taskdef-employee.json</code></p>
                    </li>
                    <li>
                        <p><span>AWS CodeDeploy AppSpec file: </span><strong><span>SourceArtifact</span></strong></p>
                    </li>
                    <li>
                        <p><span>Path: </span><code>appspec-employee.yaml</code></p>
                    </li>
                </ul>
            </li>
        </ul>
    </li>
    <li>
        <p><span>Add another </span><em><span>source</span></em><span> to the employee microservice pipeline. Add an
                action with the following details:</span></p>
        <ul>
            <li>
                <p><span>Action name: </span><code>Image</code></p>
            </li>
            <li>
                <p><span>Action provider: </span><strong><span>Amazon ECR</span></strong></p>
            </li>
            <li>
                <p><span>Repository name: </span><strong><span>employee</span></strong></p>
            </li>
            <li>
                <p><span>Image tag: </span><strong><span>latest</span></strong></p>
            </li>
            <li>
                <p><span>Output artifacts: </span><code>image-employee</code></p>
            </li>
        </ul>
    </li>
    <li>
        <p><span>Edit the Amazon ECS (Blue/Green) action in the deploy stage:</span></p>
        <ul>
            <li>
                <p><span>Add another </span><em><span>input artifact</span></em><span> and choose
                    </span><strong><span>image-employee</span></strong><span>.</span></p>
            </li>
            <li>
                <p><span>Under </span><strong><span>Dynamically update task definition image</span></strong><span>, for
                    </span><strong><span>Input artifact with image details</span></strong><span>, choose
                    </span><strong><span>image-employee</span></strong><span>.</span></p>
            </li>
            <li>
                <p><span>For </span><strong><span>Placeholder text in the task definition</span></strong><span>, enter
                    </span><code>IMAGE1_NAME</code></p>
                <p>&nbsp;</p>
            </li>
        </ul>
    </li>
</ol>
<h3 id="a-idp8t5atask-85-test-the-cicd-pipeline-for-the-employee-microservice"><a id="p8t5"></a><span>Task 8.5: Test the
        CI/CD pipeline for the </span><em><span>employee</span></em><span> microservice</span></h3>
<p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
<p><span>In this task, you will test the pipeline that you just defined for the
    </span><em><span>employee</span></em><span> microservice.</span></p>
<p><i class="fa-solid fa-circle-exclamation" aria-label="Important icon"></i><span>
    </span><strong><span>Important:</span></strong><span> If you are repeating this task, confirm that all target groups
        are still associated with the Application Load Balancer. The </span><a href="#app2" target="_self"
        rel="noopener noreferrer"><span>Reassociate Target Groups with Load Balancer</span></a><span> section of the
        appendix provides detail if needed.</span></p>
<ol start="">
    <li>
        <p><span>Launch a deployment of the </span><em><span>employee</span></em><span> microservice on Amazon ECS on
                Fargate.</span></p>
        <ul>
            <li>
                <p><span>Use the </span><em><span>release change</span></em><span> feature to force a test of the
                        pipeline.</span></p>
            </li>
            <li>
                <p><span>Follow the progress in CodeDeploy. Within a few minutes, if everything was configured
                        correctly, all of the </span><em><span>Deployment lifecycle events</span></em><span> should
                        succeed.</span></p>
            </li>
        </ul>
    </li>
    <li>
        <p><span>Load the </span><em><span>employee</span></em><span> microservice in a browser tab.</span></p>
        <ul>
            <li>
                <p><span>In the browser tab where the customer microservice is running, choose
                    </span><strong><span>Administrator link</span></strong><span>.</span></p>
                <p><span>You are directed to a page in the format </span><em><a
                            href="http://microserviceslb-UNIQUE-NUMBER.us-east-1.elb.amazonaws.com/admin/suppliers"
                            target="_blank" class="url"
                            rel="noopener noreferrer">http://microserviceslb-UNIQUE-NUMBER.us-east-1.elb.amazonaws.com/admin/suppliers</a></em><span>.</span>
                </p>
                <p><span>The employee microservice loads. If it doesn't load, try adding </span><code>:8080</code><span>
                        just after </span><code>amazonaws.com</code><span> in the URL.</span></p>
            </li>
            <li>
                <p><span>Choose </span><strong><span>List of suppliers</span></strong><span> or
                    </span><strong><span>Suppliers list</span></strong><span>.</span></p>
                <p><span>The suppliers page should load. This version of the page should
                    </span><em><span>not</span></em><span> have the edit or add supplier buttons. All links in the café
                        web application should now work because you have now deployed both microservices.</span></p>
            </li>
        </ul>
    </li>
    <li>
        <p><span>Observe the running tasks in the Amazon ECS console.</span></p>
        <p><span>The </span><strong><span>Deployments and tasks</span></strong><span> status will change as the
                blue/green deployment advances through its lifecycle events.</span></p>
    </li>
    <li>
        <p><span>Return to the CodeDeploy page to confirm that all five steps of the deployment succeeded and the
                replacement task set is now serving traffic.</span></p>
    </li>
</ol>
<p><span>Congratulations! You successfully deployed the employee microservice to Amazon ECS on Fargate by using a CI/CD
        pipeline.</span></p>
<p>&nbsp;</p>
<h3 id="a-idp8t6atask-86-observe-how-codedeploy-modified-the-load-balancer-listener-rules"><a id="p8t6"></a><span>Task
        8.6: Observe how CodeDeploy modified the load balancer listener rules</span></h3>
<p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
<ol start="">
    <li>
        <p><span>Observe the load balancer and target group settings.</span></p>
        <ul>
            <li>
                <p><span>In the Amazon EC2 console, choose </span><strong><span>Target
                            Groups</span></strong><span>.</span></p>
                <p><i class="fa-solid fa-note-sticky" aria-label="Note icon"></i><span>
                    </span><strong><span>Note:</span></strong><span> If you already had the page open, refresh
                        it.</span></p>
                <p><span>Notice that the </span><em><span>customer-tg-two</span></em><span> target group is no longer
                        associated with the load balancer. This is because CodeDeploy is managing the load balancer
                        listener rules.</span></p>
                <p><i class="fa-solid fa-note-sticky" aria-label="Note icon"></i><span>
                    </span><strong><span>Note:</span></strong><span> If you are repeating this step, the target groups
                        that are currently attached and unattached might be different.</span></p>
            </li>
            <li>
                <p><span>Observe the HTTP:80 listener rules.</span></p>
                <p><span>The default rule has changed here. For the default "If no other rule applies" rule, the
                        "forward to target group" previously pointed to
                    </span><em><span>customer-tg-two</span></em><span>, but now it points to
                    </span><em><span>customer-tg-one</span></em><span>.</span></p>
            </li>
        </ul>
        <ul>
            <li>
                <p><span>Observe the HTTP:8080 listener rules.</span></p>
                <p><span>The two rules still forward to the "one" target groups.</span></p>
                <p><span> </span></p>
            </li>
        </ul>
    </li>
</ol>
<h2 id="a-idp9aphase-9-adjusting-the-microservice-code-to-cause-a-pipeline-to-run-again"><a id="p9"></a><span>Phase 9:
        Adjusting the microservice code to cause a pipeline to run again</span></h2>
<p><span>In this phase, you will experience the benefits of the microservices architecture and the CI/CD pipeline that
        you built. You will begin by adjusting the load balancer listener rules that are related to the
    </span><em><span>employee</span></em><span> microservice. You will also update the source code of the
    </span><em><span>employee</span></em><span> microservice, generate a new Docker image, and push that image to Amazon
        ECR, which will cause the pipeline to run and update the production deployment. You will also scale up the
        number of containers that support the </span><em><span>customer</span></em><span> microservice.</span></p>
<h3 id="a-idp9t1atask-91-limit-access-to-the-employee-microservice"><a id="p9t1"></a><span>Task 9.1: Limit access to the
    </span><em><span>employee</span></em><span> microservice</span></h3>
<p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
<p><span>In this task, you will limit access to the </span><em><span>employee</span></em><span> microservice to only
        people who try to connect to it from a specific IP address. By limiting the source IP to a specific IP address,
        only users who access the application from that IP can access the pages, and edit or delete supplier
        entries.</span></p>
<p>&nbsp;</p>
<ol start="">
    <li>
        <p><span>Confirm that all target groups are still associated with the Application Load Balancer.</span></p>
        <p><span>In the Amazon EC2 console, check that all four target groups are still associated with the load
                balancer. Reassociate target groups as needed before going to the next step.</span></p>
        <p><i class="fa-solid fa-lightbulb" aria-label="Tip icon"></i><span>
            </span><strong><span>Tip:</span></strong><span> For details, see </span><a href="#app2" target="_self"
                rel="noopener noreferrer"><span>Reassociating target groups with the load balancer</span></a><span> in
                the appendix.</span></p>
    </li>
    <li>
        <p><span>Discover your public IPv4 address. </span><!--testing note: won't work on VPN--></p>
        <p><i class="fa-solid fa-lightbulb" aria-label="Tip icon"></i><span>
            </span><strong><span>Tip:</span></strong><span> One resource you can use to do this is </span><a
                href="https://www.whatismyip.com" target="_blank" class="url"
                rel="noopener noreferrer">https://www.whatismyip.com</a><span>.</span></p>
    </li>
    <li>
        <p><span>Edit the rules for the </span><strong><span>HTTP:80</span></strong><span> listener.</span></p>
        <p><span>For the rule that currently has "IF Path is /admin/*" in the details, add a second condition to route
                the user to the target groups only if the source IP of the request is your IP address.</span></p>
        <p><i class="fa-solid fa-lightbulb" aria-label="Tip icon"></i><span>
            </span><strong><span>Tip:</span></strong><span> For the source IP, paste in your public IPv4 address and
                then add </span><code>/32</code><span>. The following image shows an example:</span></p>
        <p><img src="images/limit-source-ip.png" referrerpolicy="no-referrer" alt="Example of a source IP."></p>
    </li>
    <li>
        <p><span>Edit the rules for the </span><strong><span>HTTP:8080</span></strong><span> listener.</span></p>
        <p><span>Edit the rules in the same way that you edited the rules for the
            </span><strong><span>HTTP:80</span></strong><span> listener. You want access to the employee target groups
                to be limited to your IP address.</span></p>
        <p>&nbsp;</p>
    </li>
</ol>
<h3 id="a-idp9t2atask-92-adjust-the-ui-for-the-employee-microservice-and-push-the-updated-image-to-amazon-ecr"><a
        id="p9t2"></a><span>Task 9.2: Adjust the UI for the </span><em><span>employee</span></em><span> microservice and
        push the updated image to Amazon ECR</span></h3>
<p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
<p><span>In this task, you will adjust the deployed microservices.</span></p>
<p>&nbsp;</p>
<ol start="">
    <li>
        <p><span>Edit the employee/views/</span><strong><span>nav.html</span></strong><span> file.</span></p>
        <ul>
            <li>
                <p><span>On line 1, change </span><code>navbar-dark bg-dark</code><span> to
                    </span><code>navbar-light bg-light</code></p>
            </li>
            <li>
                <p><span>Save the change.</span></p>
            </li>
        </ul>
    </li>
</ol>
<ol start="2">
    <li>
        <p><span>To generate a new Docker image from the </span><em><span>employee</span></em><span> microservice source
                files that you modified and to label the image, run the following commands:</span></p>
        <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false"
            lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">docker <span class="cm-builtin">rm</span> <span class="cm-attribute">-f</span> employee_1 </span></pre>
        </div>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">cd</span> ~/environment/microservices/employee</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">docker build <span class="cm-attribute">--tag</span> employee .</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">dbEndpoint</span><span class="cm-operator">=</span><span class="cm-quote">$(cat ~/environment/microservices/employee/app/config/config.js | grep 'APP_DB_HOST' | cut -d '"' -f2)</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">echo</span> <span class="cm-def">$dbEndpoint</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">account_id</span><span class="cm-operator">=</span><span class="cm-quote">$(aws sts get-caller-identity |grep Account|cut -d '"' -f4)</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">echo</span> <span class="cm-def">$account_id</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">docker tag employee:latest <span class="cm-def">$account_id</span>.dkr.ecr.us-east-1.amazonaws.com/employee:latest</span></pre>
        </div>
        </div>
        </div>
        </div>
        </div>
        <div
            style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 198px;">
        </div>
        <div class="CodeMirror-gutters" style="display: none; height: 198px;"></div>
        </div>
        </div>
        </pre>
    </li>
    <li>
        <p><span>Push an updated image to Amazon ECR so that the
            </span><em><span>update-employee-microservice</span></em><span> pipeline will be invoked.</span></p>
        <ul>
            <li>
                <p><span>In the CodePipeline console, navigate to the details page for the
                    </span><em><span>update-employee-microservice</span></em><span> pipeline. Keep this page
                        open.</span></p>
            </li>
            <li>
                <p><span>To push the new employee microservice Docker image to Amazon ECR, run the following commands in
                        your AWS Cloud9 IDE:</span></p>
                <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false"
                    lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#refresh credentials in case needed</span></span></pre>
                </div>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;">aws ecr get-login-password <span class="cm-attribute">--region</span> us-east-1 | docker login <span class="cm-attribute">--username</span> AWS <span class="cm-attribute">--password-stdin</span> <span class="cm-def">$account_id</span>.dkr.ecr.us-east-1.amazonaws.com</span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#push the image</span></span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;">docker push <span class="cm-def">$account_id</span>.dkr.ecr.us-east-1.amazonaws.com/employee:latest</span></pre>
                </div>
                </div>
                </div>
                </div>
                </div>
                <div
                    style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 110px;">
                </div>
                <div class="CodeMirror-gutters" style="display: none; height: 110px;"></div>
                </div>
                </div>
                </pre>
            </li>
        </ul>
        <ul>
            <li>
                <p><span>Confirm that the output is similar to the following.</span></p>
                <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false"
                    lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">b20e9725db21: Pushed </span></pre>
                </div>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;">715b0f96c609: Pushed </span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;">44141cf9260f: Layer already exists </span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;">d81d715330b7: Layer already exists </span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;">1dc7f3bb09a4: Layer already exists </span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;">dcaceb729824: Layer already exists </span></pre>
                <pre class=" CodeMirror-line "
                    role="presentation"><span role="presentation" style="padding-right: 0.1px;">f1b5933fe4b5: Layer already exists </span></pre>
                </div>
                </div>
                </div>
                </div>
                </div>
                <div
                    style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 154px;">
                </div>
                <div class="CodeMirror-gutters" style="display: none; height: 154px;"></div>
                </div>
                </div>
                </pre>
                <p><span>At least one layer should indicate that it was pushed, which indicates that the image was
                        modified since it was last pushed to Amazon ECR. You could also look in the Amazon ECR
                        repository to confirm the last modified timestamp of the image that is tagged as the
                        latest.</span>
                    <span> </span><br><span> </span>
                </p>
            </li>
        </ul>
    </li>
</ol>
<h3 id="a-idp9t3atask-93-confirm-that-the-employee-pipeline-ran-and-the-microservice-was-updated"><a
        id="p9t3"></a><span>Task 9.3: Confirm that the </span><em><span>employee</span></em><span> pipeline ran and the
        microservice was updated</span></h3>
<p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
<p>&nbsp;</p>
<ol start="">
    <li>
        <p><span>Observe the </span><em><span>update-employee-microservice</span></em><span> pipeline details in the
                CodePipeline console.</span></p>
        <p><span>Notice that when you uploaded a new Docker image to Amazon ECR, the pipeline was invoked and ran. Note
                that the pipeline might take a minute or two to notice that the Docker image was updated before the
                pipeline is invoked.</span></p>
    </li>
    <li>
        <p><span>Observe the details in the CodeDeploy console.</span></p>
        <p>&nbsp;</p>
    </li>
</ol>
<h3 id="a-idp9t4atask-94-test-access-to-the-employee-microservice"><a id="p9t4"></a><span>Task 9.4: Test access to the
    </span><em><span>employee</span></em><span> microservice</span></h3>
<p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
<p><span>In this task, you will test access to the </span><em><span>employee</span></em><span> microservice.</span></p>
<p>&nbsp;</p>
<ol start="">
    <li>
        <p><span>Test access to the </span><em><span>employee</span></em><span> microservice pages at
            </span><code>http://&lt;alb-endpoint&gt;/admin/suppliers</code><span> and
            </span><code>http://&lt;alb-endpoint&gt;:8080/admin/suppliers</code><span> from the same device that you
                have used for this project so far. Replace
            </span><em><span>&lt;</span><span>alb-endpoint</span><span>&gt;</span></em><span> with the DNS name of the
            </span><em><span>microservicesLB</span></em><span> load balancer.</span></p>
        <p><span>At least one of the two pages should load successfully.</span></p>
        <p><span>Notice that the banner with the page title is a light color now because of the change that you made to
                the nav.html file. Pages that are hosted by the customer microservice still have the dark banner. This
                demonstrates that by using a microservices architecture, you could independently modify the UI or
                features of each microservice without affecting others.</span></p>
    </li>
    <li>
        <p><span>Test access to the same </span><em><span>employee</span></em><span> microservice pages from a different
                device.</span></p>
        <p><span>For example, you could use your phone to connect from the cellular network and not the same Wi-Fi
                network that your computer uses. You want the device to use a different IP address to connect to the
                internet than your computer.</span></p>
        <p><span>You should get a 404 error on any page that loads, and the page should say "Coffee suppliers" instead
                of "Manage coffee suppliers." This is evidence that you cannot successfully connect to the employee
                microservice from another IP address.</span></p>
        <p><i class="fa-solid fa-lightbulb" aria-label="Tip icon"></i><span>
            </span><strong><span>Tip:</span></strong><span> If you don't have another network available, run the
                following command in the AWS Cloud9 terminal:
            </span><code>curl http://&lt;alb-endpoint&gt;/admin/suppliers</code><span>. The source IP address of the AWS
                Cloud9 instance is different than your browser's source IP. The result should include
            </span><code>&lt;p class="lead"&gt;Sorry, we don't seem to have that page in stock&lt;/p&gt;</code><span>.</span>
        </p>
        <p><span>This proves that the updated rules on the load balancer listener are working as intended.</span></p>
        <p><i class="fa-solid fa-lightbulb" aria-label="Tip icon"></i><span>
            </span><strong><span>Tip:</span></strong><span> If the update doesn't function as intended, you could go to
                the </span><strong><span>Deployments</span></strong><span> page in the CodeDeploy console within 5
                minutes to stop the deployment and roll back to the previous version. You would choose
            </span><strong><span>Stop and roll back deployment</span></strong><span> and then choose
            </span><strong><span>Stop and rollback</span></strong><span>. This action would reroute production traffic
                to the original task set and then delete the replacement task set. You configured the 5-minute setting
                in phase 8, task 1.</span></p>
        <p>&nbsp;</p>
    </li>
</ol>
<h3 id="a-idp9t5atask-95-scale-the-customer-microservice"><a id="p9t5"></a><span>Task 9.5: Scale the
    </span><em><span>customer</span></em><span> microservice</span></h3>
<p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
<p><span>In this task, you will scale up the number of containers that run to support the
    </span><em><span>customer</span></em><span> microservice. You can make this change without causing the
    </span><em><span>update-customer-microservice</span></em><span> pipeline to run.</span></p>
<p>&nbsp;</p>
<ol start="">
    <li>
        <p><span>Update the </span><em><span>customer</span></em><span> service in Amazon ECS.</span></p>
        <ul>
            <li>
                <p><span>Run the following command:</span></p>
                <pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false"
                    lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">aws ecs update-service <span class="cm-attribute">--cluster</span> microservices-serverlesscluster <span class="cm-attribute">--service</span> customer-microservice <span class="cm-attribute">--desired-count</span> <span class="cm-number">3</span></span></pre>
                </div>
                </div>
                </div>
                </div>
                </div>
                </div>
                <div
                    style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 44px;">
                </div>
                <div class="CodeMirror-gutters" style="display: none; height: 44px;"></div>
                </div>
                </div>
                </pre>
                <p><span>A large JSON-formatted response is returned.</span></p>
            </li>
        </ul>
        <ul>
            <li>
                <p><span>Go to the </span><a
                        href="https://us-east-1.console.aws.amazon.com/ecs/v2/clusters/microservices-serverlesscluster/services?region=us-east-1"
                        target="_blank" rel="noopener noreferrer"><span>Amazon ECS services
                            view</span></a><span>.</span></p>
                <p><span>It might look similar to the following image.</span></p>
                <p><span> </span><img src="images/services.png" referrerpolicy="no-referrer"
                        alt="Microservices listed in the Amazon ECS console."></p>
                <p><span>In this example, the </span><em><span>customer-microservice</span></em><span> shows 1/3 tasks
                        running because you increased the desired count from 1 to 3, but the two new containers are
                        still being started. If you wait long enough and look at the
                    </span><strong><span>Tasks</span></strong><span> tab, you will see that three containers run to
                        support the customer microservice. This demonstrates how you can scale microservices
                        independently of one another.</span></p>
                <p><i class="fa-solid fa-note-sticky" aria-label="Note icon"></i><span>
                    </span><strong><span>Note:</span></strong><span> The
                    </span><em><span>employee-microservice</span></em><span> might show 2/1 tasks running. This could
                        happen because a replacement task set (which has one container) has been created, but the
                        original task set remains active for the first 5 minutes in case you decide to roll back.</span>
                </p>
                <p><span> </span></p>
            </li>
        </ul>
    </li>
</ol>
<h2 id="ending-your-session"><span>Ending your session</span></h2>
<p><strong><span>Reminder:</span></strong><span> This is a long-lived lab environment. Data is retained until you either
        use the allocated budget or the course end date is reached (whichever occurs first).</span></p>
<p><span>To preserve your budget when you are finished for the day, or when you are finished actively working on the
        assignment for the time being, do the following:</span></p>
<p>&nbsp;</p>
<ol start="">
    <li>
        <p><span>At the top of this page, choose </span><i class="fas fa-square"></i><span> </span><strong><span>End
                    Lab</span></strong><span>, and then choose </span><span id="ssb_blue"><span>Yes</span></span><span>
                to confirm that you want to end the lab.</span></p>
        <p><span>A message panel indicates that the lab is terminating.</span></p>
        <p><i class="fa-solid fa-note-sticky" aria-label="Note icon"></i><span>
            </span><strong><span>Note:</span></strong><span> Choosing </span><strong><span>End Lab</span></strong><span>
                in this environment will </span><em><span>not</span></em><span> delete the resource you have created.
                They will still be there the next time you choose Start lab (for example, on another day).</span></p>
    </li>
    <li>
        <p><span>To close the panel, choose </span><strong><span>Close</span></strong><span> in the upper-right
                corner.</span></p>
        <p>&nbsp;</p>
    </li>
</ol>
<h1 id="a-idappaappendix"><a id="app"></a><span>Appendix</span></h1>
<h2 id="a-idapp1aupdating-a-test-container-that-is-running-on-aws-cloud9"><a id="app1"></a><span>Updating a test
        container that is running on AWS Cloud9</span></h2>
<p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
<p><span>If you need to update the source code of a microservice </span><em><span>after</span></em><span> running the
        container, you need to (1) stop and delete the container, (2) build a new image, and (3) run the new image. The
        following sections provide a reference to complete these steps.</span></p>
<h3 id="updating-the-customer-container-that-is-running-on-aws-cloud9"><span>Updating the
    </span><em><span>customer</span></em><span> container that is running on AWS Cloud9</span></h3>
<pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"
    style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Stop and delete the specified container (assumes that the container name is customer_1)</span></span></pre>
</div>
<pre class=" CodeMirror-line "
    role="presentation"><span role="presentation" style="padding-right: 0.1px;">docker <span class="cm-builtin">rm</span> <span class="cm-attribute">-f</span> customer_1 </span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
    </span></span></pre>
<pre class=" CodeMirror-line "
    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Must be in the directory that has the Dockerfile before you attempt to build a new image</span></span></pre>
<pre class=" CodeMirror-line "
    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">cd</span> ~/environment/microservices/customer</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
    </span></span></pre>
<pre class=" CodeMirror-line "
    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Build a new image from the latest source files and overwrite any existing image</span></span></pre>
<pre class=" CodeMirror-line "
    role="presentation"><span role="presentation" style="padding-right: 0.1px;">docker build <span class="cm-attribute">--tag</span> customer .</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
    </span></span></pre>
<pre class=" CodeMirror-line "
    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Ensure the dbEndpoint variable is set in your terminal session </span></span></pre>
<pre class=" CodeMirror-line "
    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">dbEndpoint</span><span class="cm-operator">=</span><span class="cm-quote">$(cat ~/environment/microservices/customer/app/config/config.js | grep 'APP_DB_HOST' | cut -d '"' -f2)</span></span></pre>
<pre class=" CodeMirror-line "
    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">echo</span> <span class="cm-def">$dbEndpoint</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
    </span></span></pre>
<pre class=" CodeMirror-line "
    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Create and run a new container from the image (and pass the DB location to the container)</span></span></pre>
<pre class=" CodeMirror-line "
    role="presentation"><span role="presentation" style="padding-right: 0.1px;">docker run <span class="cm-attribute">-d</span> <span class="cm-attribute">--name</span> customer_1 <span class="cm-attribute">-p</span> <span class="cm-number">8080</span>:8080 <span class="cm-attribute">-e</span> <span class="cm-def">APP_DB_HOST</span><span class="cm-operator">=</span><span class="cm-string">"</span><span class="cm-def">$dbEndpoint</span><span class="cm-string">"</span>  customer</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
    </span></span></pre>
<pre class=" CodeMirror-line "
    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># URL to test the microservice running on the AWS Cloud9 test container </span></span></pre>
<pre class=" CodeMirror-line "
    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">echo</span> <span class="cm-string">"Customer microservice test container running at http://"</span><span class="cm-quote">$(curl ifconfig.me)</span>:8080</span></pre>
</div>
</div>
</div>
</div>
</div>
<div
    style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 418px;">
</div>
<div class="CodeMirror-gutters" style="display: none; height: 418px;"></div>
</div>
</div>
</pre>
<h3 id="updating-the-employee-container-that-is-running-on-aws-cloud9"><span>Updating the
    </span><em><span>employee</span></em><span> container that is running on AWS Cloud9</span></h3>
<pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"
    style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Stop and delete the specified container (assumes that the container name is employee_1)</span></span></pre>
</div>
<pre class=" CodeMirror-line "
    role="presentation"><span role="presentation" style="padding-right: 0.1px;">docker <span class="cm-builtin">rm</span> <span class="cm-attribute">-f</span> employee_1 </span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
    </span></span></pre>
<pre class=" CodeMirror-line "
    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Must be in the directory that has the Dockerfile before you attempt to build a new image</span></span></pre>
<pre class=" CodeMirror-line "
    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">cd</span> /home/ec2-user/environment/microservices/employee</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
    </span></span></pre>
<pre class=" CodeMirror-line "
    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Build a new image from the latest source files and overwrite any existing image</span></span></pre>
<pre class=" CodeMirror-line "
    role="presentation"><span role="presentation" style="padding-right: 0.1px;">docker build <span class="cm-attribute">--tag</span> employee .</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
    </span></span></pre>
<pre class=" CodeMirror-line "
    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Ensure the dbEndpoint variable is set in your terminal session</span></span></pre>
<pre class=" CodeMirror-line "
    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">dbEndpoint</span><span class="cm-operator">=</span><span class="cm-quote">$(cat ~/environment/microservices/customer/app/config/config.js | grep 'APP_DB_HOST' | cut -d '"' -f2)</span></span></pre>
<pre class=" CodeMirror-line "
    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">echo</span> <span class="cm-def">$dbEndpoint</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
    </span></span></pre>
<pre class=" CodeMirror-line "
    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Create and run a new container from the image (and pass the DB location to the container)</span></span></pre>
<pre class=" CodeMirror-line "
    role="presentation"><span role="presentation" style="padding-right: 0.1px;">docker run <span class="cm-attribute">-d</span> <span class="cm-attribute">--name</span> employee_1 <span class="cm-attribute">-p</span> <span class="cm-number">8081</span>:8081 <span class="cm-attribute">-e</span> <span class="cm-def">APP_DB_HOST</span><span class="cm-operator">=</span><span class="cm-string">"</span><span class="cm-def">$dbEndpoint</span><span class="cm-string">"</span>  employee</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
    </span></span></pre>
<pre class=" CodeMirror-line "
    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># URL to test the microservice running on the AWS Cloud9 test container </span></span></pre>
<pre class=" CodeMirror-line "
    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">echo</span> <span class="cm-string">"Employee microservice test container running at http://"</span><span class="cm-quote">$(curl ifconfig.me)</span>:8081/admin/suppliers</span></pre>
</div>
</div>
</div>
</div>
</div>
<div
    style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 440px;">
</div>
<div class="CodeMirror-gutters" style="display: none; height: 440px;"></div>
</div>
</div>
</pre>
<h3 id="reference-other-docker-commands"><span>Reference: Other Docker commands</span></h3>
<p><span>To find the commands that you need to run, see </span><a
        href="https://docs.docker.com/engine/reference/commandline/cli/" target="_blank"
        rel="noopener noreferrer"><span>Use the Docker Command Line</span></a><span> in the Docker documentation.</span>
</p>
<p><span>The following selected commands could be helpful:</span></p>
<pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false"
    lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">docker container <span class="cm-builtin">ls</span> <span class="cm-comment"># List the running containers</span></span></pre>
</div>
<pre class=" CodeMirror-line "
    role="presentation"><span role="presentation" style="padding-right: 0.1px;">docker <span class="cm-builtin">rm</span> <span class="cm-attribute">-f</span> &lt;container&gt; <span class="cm-comment"># Stop and delete the specified container</span></span></pre>
<pre class=" CodeMirror-line "
    role="presentation"><span role="presentation" style="padding-right: 0.1px;">docker images <span class="cm-comment"># List the images</span></span></pre>
<pre class=" CodeMirror-line "
    role="presentation"><span role="presentation" style="padding-right: 0.1px;">docker build <span class="cm-attribute">--tag</span> &lt;tag-for-image&gt; . <span class="cm-comment"># Create a new image from a Dockerfile (must be in the same directory as the Dockerfile)</span></span></pre>
<pre class=" CodeMirror-line "
    role="presentation"><span role="presentation" style="padding-right: 0.1px;">docker run <span class="cm-attribute">-d</span> <span class="cm-attribute">--name</span> &lt;name-to-give-container&gt; <span class="cm-attribute">-p</span> &lt;port&gt;:&lt;port&gt; &lt;image-tag&gt; <span class="cm-comment"># Run a container from an image</span></span></pre>
<pre class=" CodeMirror-line "
    role="presentation"><span role="presentation" style="padding-right: 0.1px;">docker <span class="cm-builtin">ps</span> <span class="cm-comment"># List the running Docker containers</span></span></pre>
</div>
</div>
</div>
</div>
</div>
<div
    style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 176px;">
</div>
<div class="CodeMirror-gutters" style="display: none; height: 176px;"></div>
</div>
</div>
</pre>
<h3 id="reference-network-analysis-and-viewing-docker-logs"><span>Reference: Network analysis and viewing Docker
        logs</span></h3>
<pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false"
    lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Helpful commands to see what is happening</span></span></pre>
</div>
<pre class=" CodeMirror-line "
    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">sudo</span> lsof <span class="cm-attribute">-i</span> :8080</span></pre>
<pre class=" CodeMirror-line "
    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">sudo</span> lsof <span class="cm-attribute">-i</span> :8081</span></pre>
<pre class=" CodeMirror-line "
    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">ps</span> <span class="cm-attribute">-ef</span> | head <span class="cm-attribute">-1</span>; <span class="cm-builtin">ps</span> <span class="cm-attribute">-ef</span> | <span class="cm-builtin">grep</span> docker</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
    </span></span></pre>
<pre class=" CodeMirror-line "
    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Docker log viewing - returns container numbers</span></span></pre>
<pre class=" CodeMirror-line "
    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">sudo</span> <span class="cm-builtin">ls</span> /var/lib/docker/containers</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
    </span></span></pre>
<pre class=" CodeMirror-line "
    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># View the log for a container where you know the container number</span></span></pre>
<pre class=" CodeMirror-line "
    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">sudo</span> less /var/lib/docker/containers/&lt;container-number&gt;/*.log</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
    </span></span></pre>
<pre class=" CodeMirror-line "
    role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># See the IP addresses that Docker containers use</span></span></pre>
<pre class=" CodeMirror-line "
    role="presentation"><span role="presentation" style="padding-right: 0.1px;">docker inspect network bridge</span></pre>
</div>
</div>
</div>
</div>
</div>
<div
    style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 286px;">
</div>
<div class="CodeMirror-gutters" style="display: none; height: 286px;"></div>
</div>
</div>
</pre>
<h2 id="a-idapp2areassociating-target-groups-with-the-load-balancer"><a id="app2"></a><span>Reassociating target groups
        with the load balancer</span></h2>
<p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
<p><span>Because CodeDeploy manages the Application Load Balancer rules, you might periodically find that some target
        groups are no longer associated with the load balancer. The following steps explain how to reassociate the
        target groups.</span></p>
<ol start="">
    <li>
        <p><span>Note the original configuration that you made for the
            </span><strong><span>HTTP:80</span></strong><span> listener.</span></p>
        <p><span>The following image shows the original configuration for this listener:</span></p>
        <p><img src="images/LB-rules-80.png" referrerpolicy="no-referrer" alt="original HTTP:80 rules"></p>
        <p><span>If you successfully deployed the microservices previously, and the settings that are shown in the
                previous image are currently in use for the deployment (where the target groups in use by the HTTP:80
                listener have "two" in their names), then this time you want to set the HTTP:80 listener to use target
                groups that have "one" in their names. Effectively, the green task set has become the blue task set, and
                the blue task set has become the green task set.</span></p>
    </li>
    <li>
        <p><span>Edit the </span><strong><span>HTTP:80</span></strong><span> load balancer rules to make sure that they
                still match the previous image. If they don't, adjust them:</span></p>
        <ul>
            <li>
                <p><span>Navigate to the Amazon EC2 console.</span></p>
            </li>
            <li>
                <p><span>In the navigation pane, choose </span><strong><span>Load
                            Balancers</span></strong><span>.</span></p>
            </li>
            <li>
                <p><span>Choose the link for the </span><strong><span>microservicesLB</span></strong><span> load
                        balancer.</span></p>
            </li>
            <li>
                <p><span>On the </span><strong><span>Listeners and rules</span></strong><span> tab, choose the
                    </span><strong><span>HTTP:80</span></strong><span> link.</span></p>
            </li>
            <li>
                <p><span>In the </span><strong><span>Listener rules</span></strong><span> panel, verify that the
                    </span><strong><span>Default</span></strong><span> rule forwards to
                    </span><strong><span>customer-tg-one</span></strong><span>. If it doesn't:</span></p>
                <ul>
                    <li>
                        <p><span>Select the rule.</span></p>
                    </li>
                    <li>
                        <p><span>From the </span><strong><span>Actions</span></strong><span> menu, choose
                            </span><strong><span>Edit rule</span></strong><span>.</span></p>
                    </li>
                    <li>
                        <p><span>Set </span><strong><span>Forward to target group</span></strong><span> to
                            </span><strong><span>customer-tg-one</span></strong><span>, and choose
                            </span><strong><span>Save changes</span></strong><span>.</span></p>
                    </li>
                </ul>
            </li>
            <li>
                <p><span>Still on the </span><strong><span>HTTP:80</span></strong><span> page, in the
                    </span><strong><span>Listener rules</span></strong><span> panel, verify that the rule with
                    </span><strong><span>Path Pattern is /admin/</span></strong><span> forwards to
                    </span><strong><span>employee-tg-one</span></strong><span>. If it doesn't:</span></p>
                <ul>
                    <li>
                        <p><span>Select the rule.</span></p>
                    </li>
                    <li>
                        <p><span>From the </span><strong><span>Actions</span></strong><span> menu, choose
                            </span><strong><span>Edit rule</span></strong><span>, and then choose
                            </span><strong><span>Next</span></strong><span>.</span></p>
                    </li>
                    <li>
                        <p><span>In the </span><strong><span>Actions</span></strong><span> panel, set
                            </span><strong><span>Forward to target group</span></strong><span> to
                            </span><strong><span>employee-tg-one</span></strong><span>.</span></p>
                    </li>
                    <li>
                        <p><span>Choose </span><strong><span>Next</span></strong><span>, and then choose
                            </span><strong><span>Save changes</span></strong><span>.</span></p>
                    </li>
                </ul>
            </li>
        </ul>
    </li>
</ol>
<ol start="3">
    <li>
        <p><span>Note the original configuration that you made for the
            </span><strong><span>HTTP:8080</span></strong><span> listener.</span></p>
        <p><span>The following image shows the original configuration for this listener:</span></p>
        <p><img src="images/LB-rules-8080.png" referrerpolicy="no-referrer" alt="original HTTP:8080 rules"></p>
        <p><span>If you successfully deployed the microservices previously, and the settings that are shown in the
                previous image are currently in use for the deployment (where the target groups in use by the HTTP:8080
                listener have "one" in their names), then this time you want to set the HTTP:8080 listener to use target
                groups that have "two" in their names. </span></p>
    </li>
    <li>
        <p><span>Edit the </span><strong><span>HTTP:8080</span></strong><span> load balancer rules to make sure that
                they still match the previous image. If they don't, adjust them:</span></p>
        <ul>
            <li>
                <p><span>Navigate to the Amazon EC2 console.</span></p>
            </li>
            <li>
                <p><span>In the navigation pane, choose </span><strong><span>Load
                            Balancers</span></strong><span>.</span></p>
            </li>
            <li>
                <p><span>Choose the link for the </span><strong><span>microservicesLB</span></strong><span> load
                        balancer.</span></p>
            </li>
            <li>
                <p><span>On the </span><strong><span>Listeners and rules</span></strong><span> tab, choose the
                    </span><strong><span>HTTP:8080</span></strong><span> link.</span></p>
            </li>
            <li>
                <p><span>In the </span><strong><span>Listener rules</span></strong><span> panel, verify that the
                    </span><strong><span>Default</span></strong><span> rule forwards to
                    </span><strong><span>customer-tg-two</span></strong><span>. If it doesn't:</span></p>
                <ul>
                    <li>
                        <p><span>Select the rule.</span></p>
                    </li>
                    <li>
                        <p><span>From the </span><strong><span>Actions</span></strong><span> menu, choose
                            </span><strong><span>Edit rule</span></strong><span>.</span></p>
                    </li>
                    <li>
                        <p><span>Set </span><strong><span>Forward to target group</span></strong><span> to
                            </span><strong><span>customer-tg-two</span></strong><span>, and choose
                            </span><strong><span>Save changes</span></strong><span>.</span></p>
                    </li>
                </ul>
            </li>
            <li>
                <p><span>Still on the </span><strong><span>HTTP:8080</span></strong><span> page, in the
                    </span><strong><span>Listener rules</span></strong><span> panel, verify that the rule with
                    </span><strong><span>Path Pattern is /admin/</span></strong><span> forwards to
                    </span><strong><span>employee-tg-two</span></strong><span>. If it doesn't:</span></p>
                <ul>
                    <li>
                        <p><span>Select the rule.</span></p>
                    </li>
                    <li>
                        <p><span>From the </span><strong><span>Actions</span></strong><span> menu, choose
                            </span><strong><span>Edit rule</span></strong><span>, and then choose
                            </span><strong><span>Next</span></strong><span>.</span></p>
                    </li>
                    <li>
                        <p><span>In the </span><strong><span>Actions</span></strong><span> panel, set
                            </span><strong><span>Forward to target group</span></strong><span> to
                            </span><strong><span>employee-tg-two</span></strong><span>.</span></p>
                    </li>
                    <li>
                        <p><span>Choose </span><strong><span>Next</span></strong><span>, and then choose
                            </span><strong><span>Save changes</span></strong><span>.</span></p>
                    </li>
                </ul>
            </li>
        </ul>
    </li>
</ol>
<ol start="5">
    <li>
        <p><span>Confirm that all target groups are reassociated.</span></p>
        <ul>
            <li>
                <p><span>In the navigation pane of the Amazon EC2 console, choose </span><strong><span>Target
                            Groups</span></strong><span>.</span></p>
            </li>
            <li>
                <p><span>Confirm that all four target groups are now associated with the
                    </span><em><span>microservicesLB</span></em><span> load balancer.</span></p>
            </li>
        </ul>
    </li>
</ol>
<p>&nbsp;</p>
<p><i class="fa-solid fa-circle-exclamation" aria-label="Important icon"></i><span>
    </span><strong><span>Important:</span></strong><span> Each time that you run the pipelines, start by confirming that
        all four target groups are associated with the load balancer listeners and adjust as necessary.</span></p>
<p><span>In a production environment, you might choose to automate the steps that you just completed, where you want to
        check and adjust the Application Load Balancer configuration prior to each run of a pipeline. CodeDeploy
        provides a feature named AppSpec </span><em><span>hooks</span></em><span> that you can use to create a custom
        AWS Lambda function with code to accomplish tasks like this. You can then specify that the hook be run before,
        during, or after a specific lifecycle event by referencing it in your AppSpec definition. Authoring a custom
        Lambda function and using this feature is beyond the scope of this project. For more information, see </span><a
        href="https://docs.aws.amazon.com/codedeploy/latest/userguide/reference-appspec-file-structure-hooks.html"
        target="_blank" rel="noopener noreferrer"><span>AppSpec 'hooks' Section</span></a><span> in the
    </span><em><span>AWS CodeDeploy User Guide</span></em><span>.</span></p>
<p>&nbsp;</p>
<h2 id="a-idapp3atroubleshooting-tips"><a id="app3"></a><span>Troubleshooting tips</span></h2>
<p><a href="#top" target="_self" rel="noopener noreferrer"><span>Return to table of contents</span></a></p>
<p><strong><span>Issue:</span></strong><span> Records from the database don't display in the web application or
        microservice.</span></p>
<p><span>Check the following:</span></p>
<ul>
    <li>
        <p><span>If this happens when you deploy to Amazon ECS, look in the Amazon CloudWatch logs for error details.
                You might try rebooting the Amazon RDS database.</span></p>
    </li>
    <li>
        <p><span>If this happens when you test running a container on the AWS Cloud9 instance, verify that your AWS
                Cloud9 instance is running in </span><em><span>Public Subnet1</span></em><span>.</span></p>
    </li>
</ul>
<p><strong><span>Issue:</span></strong><span> Invalid action configuration</span></p>
<p><span>Check the following:</span></p>
<ul>
    <li>
        <p><span>The artifact cannot be larger than 3 MB. Look at the
            </span><strong><span>codepipeline-xxxx</span></strong><span> bucket in Amazon S3. Browse to the
            </span><strong><span>update-customer-micr/SourceArti</span></strong><span> or
            </span><strong><span>update-employee-micr/SourceArti</span></strong><span> prefix (folder). Verify that no
                object is larger than 3 MB. Only push files to the CodeCommit repository if they were mentioned in these
                instructions. Avoid posting files other than the AppSpec and task definition files to this
                repository.</span></p>
    </li>
</ul>
<p><strong><span>Issue:</span></strong><span> A message in </span><strong><span>Deployments and
            tasks</span></strong><span> in the Amazon ECS console says </span><em><span>service....-microservice is
            unable to consistently start tasks successfully</span></em><span>.</span></p>
<p><span>Check the following:</span></p>
<ul>
    <li>
        <p><span>Verify that all target groups are associated with the load balancer.</span></p>
    </li>
</ul>
<p><strong><span>Issue:</span></strong><span> The CodeDeploy deployment status is stuck at step 1, or the application
        doesn't work when deployed to Amazon ECS.</span></p>
<p><span>Check the following:</span></p>
<ul>
    <li>
        <p><span>In the Amazon ECS console, choose the link for
            </span><strong><span>microservices-serverlesscluster</span></strong><span>. Choose the name of the service
                (</span><strong><span>employee-microservice</span></strong><span> or
            </span><strong><span>customer-microservice</span></strong><span>) that is stuck. Then, choose the
            </span><strong><span>Deployments and events</span></strong><span> tab. This view shows the progress of
                CodeDeploy deploying the task set. The </span><strong><span>Configuration and
                    tasks</span></strong><span> tab can also provide helpful information because it shows whether any
                tasks (containers) have actually launched.</span></p>
    </li>
    <li>
        <p><span>In the AWS CloudTrail console, in the navigation pane, choose </span><strong><span>Event
                    history</span></strong><span>. Look for events that might have resulted in errors. To observe
                details for an event, choose the </span><strong><span>Event name</span></strong><span> link for the
                event.</span></p>
    </li>
    <li>
        <p><span>In the CloudWatch console, in the navigation pane, choose
            </span><strong><span>Logs</span></strong><span> and then choose </span><strong><span>Log
                    groups</span></strong><span>. Choose the link for the
            </span><strong><span>awslogs-capstone</span></strong><span> log group. To see detailed logs, choose the
            </span><strong><span>Log stream</span></strong><span> link for the latest event time.</span></p>
        <p>&nbsp;</p>
    </li>
</ul>
<p><span>© 2023, Amazon Web Services, Inc. or its affiliates. All rights reserved.</span></p>
</div>